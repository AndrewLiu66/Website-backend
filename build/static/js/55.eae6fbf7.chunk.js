(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[55],{1048:function(e,t,n){"use strict";n.d(t,"a",(function(){return M})),n.d(t,"b",(function(){return w})),n.d(t,"c",(function(){return S}));var r,a,i,o,c,s,u=n(143),l=n(142),d=n(144),f=n(145),h=n(32),v=n(334),b=n(349),p=n(331),m=n(209),g=n(634),O=n(886),_=n(632),x=n(443),j=n(230),T=n(1049),y=n(887),A=n(635);function M(e,t){e.include(g.a);var n=e.vertex;n.include(O.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),n.uniforms.add([new x.a("transformWorldFromViewTH",(function(e){return e.transformWorldFromViewTH})),new x.a("transformWorldFromViewTL",(function(e){return e.transformWorldFromViewTL})),new y.a("transformViewFromCameraRelativeRS",(function(e){return e.transformViewFromCameraRelativeRS})),new A.a("transformProjFromView",(function(e){return e.transformProjFromView})),new T.a("transformWorldFromModelRS",(function(e){return e.transformWorldFromModelRS})),new _.a("transformWorldFromModelTH",(function(e){return e.transformWorldFromModelTH})),new _.a("transformWorldFromModelTL",(function(e){return e.transformWorldFromModelTL}))]),n.code.add(Object(j.b)(r||(r=Object(h.a)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\ntransformWorldFromModelTL,\ntransformWorldFromModelTH,\n-transformWorldFromViewTL,\n-transformWorldFromViewTH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}"])))),n.code.add(Object(j.b)(a||(a=Object(h.a)(["\n    void forwardPosition(float fOffset) {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      if (fOffset != 0.0) {\n        vPositionWorldCameraRelative += fOffset * ",";\n      }\n\n      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;\n      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);\n    }\n  "])),t.spherical?Object(j.b)(i||(i=Object(h.a)(["normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)"]))):Object(j.b)(o||(o=Object(h.a)(["vec3(0.0, 0.0, 1.0)"]))))),e.fragment.uniforms.add(new x.a("transformWorldFromViewTL",(function(e){return e.transformWorldFromViewTL}))),n.code.add(Object(j.b)(c||(c=Object(h.a)(["vec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"])))),e.fragment.code.add(Object(j.b)(s||(s=Object(h.a)(["vec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"]))))}var S=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments)).transformWorldFromViewTH=Object(m.e)(),e.transformWorldFromViewTL=Object(m.e)(),e.transformViewFromCameraRelativeRS=Object(v.b)(),e.transformProjFromView=Object(b.d)(),e}return Object(u.a)(n)}(j.a),w=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.apply(this,arguments)).transformWorldFromModelRS=Object(v.b)(),e.transformWorldFromModelTH=Object(p.a)(),e.transformWorldFromModelTL=Object(p.a)(),e}return Object(u.a)(n)}(j.a)},1049:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"mat3",s.a.Draw,(function(t,n,a){return t.setUniformMatrix3fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},1050:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,a;n(185),n(146);(a=r||(r={}))[a.Multiply=1]="Multiply",a[a.Ignore=2]="Ignore",a[a.Replace=3]="Replace",a[a.Tint=4]="Tint"},1051:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"int",s.a.Pass,(function(t,n,a){return t.setUniform1i(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},1052:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r,a,i,o,c=n(32),s=n(496),u=n(1093),l=n(580),d=n(230),f=n(1094),h=n(464),v=n(322),b=n(299);function p(e,t){var n=e.fragment;if(t.hasVertexTangents?(e.attributes.add(b.a.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===l.b.WindingOrder?n.code.add(Object(d.b)(r||(r=Object(c.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):n.code.add(Object(d.b)(a||(a=Object(c.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add(Object(d.b)(i||(i=Object(c.a)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),t.textureCoordinateType!==s.b.None){e.include(u.a,t);var p=t.supportsTextureAtlas;n.uniforms.add(t.pbrTextureBindType===v.a.Pass?Object(h.b)("normalTexture",(function(e){return e.textureNormal}),p):Object(f.a)("normalTexture",(function(e){return e.textureNormal}),p)),n.code.add(Object(d.b)(o||(o=Object(c.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""))}}},1053:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,a,i=n(32),o=n(230);function c(e){e.vertex.code.add(Object(o.b)(r||(r=Object(i.a)(["const float PI = 3.141592653589793;"])))),e.fragment.code.add(Object(o.b)(a||(a=Object(i.a)(["const float PI = 3.141592653589793;\nconst float LIGHT_NORMALIZATION = 1.0 / PI;\nconst float INV_PI = 0.3183098861837907;\nconst float HALF_PI = 1.570796326794897;"]))))}},1054:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r,a=n(32),i=n(442),o=n(230),c=n(301);function s(e,t){var n=Object(o.b)(r||(r=Object(a.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,t.output===i.a.Color?"RenderOutput: Color":t.output===i.a.Depth?"RenderOutput: Depth":t.output===i.a.Shadow?"RenderOutput: Shadow":t.output===i.a.Normal?"RenderOutput: Normal":t.output===i.a.Highlight?"RenderOutput: Highlight":"");Object(c.c)()&&(e.fragment.code.add(n),e.vertex.code.add(n))}},1055:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(143),a=n(142),i=n(144),o=n(145),c=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){return Object(a.a)(this,n),t.call(this,e,"mat4")}return Object(r.a)(n)}(n(362).a)},1092:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return h}));var r=n(142),a=n(143),i=n(144),o=n(145),c=n(146),s=n(164),u=n(230),l=n(344),d=function(){function e(t){Object(r.a)(this,e),this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}return Object(a.a)(e,[{key:"dispose",value:function(){this._techniqueRepository.release(this._technique)}},{key:"technique",get:function(){return this._technique}},{key:"ensureTechnique",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._output;return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(n,t),this._technique),this._technique}},{key:"ensureResources",value:function(e){return l.f.LOADED}}]),e}(),f=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e))._numLoading=0,a._disposed=!1,a._textureRepository=e.textureRep,a._textureId=e.textureId,a._acquire(e.textureId,(function(e){return a._texture=e})),a._acquire(e.normalTextureId,(function(e){return a._textureNormal=e})),a._acquire(e.emissiveTextureId,(function(e){return a._textureEmissive=e})),a._acquire(e.occlusionTextureId,(function(e){return a._textureOcclusion=e})),a._acquire(e.metallicRoughnessTextureId,(function(e){return a._textureMetallicRoughness=e})),a}return Object(a.a)(n,[{key:"dispose",value:function(){this._texture=Object(c.o)(this._texture),this._textureNormal=Object(c.o)(this._textureNormal),this._textureEmissive=Object(c.o)(this._textureEmissive),this._textureOcclusion=Object(c.o)(this._textureOcclusion),this._textureMetallicRoughness=Object(c.o)(this._textureMetallicRoughness),this._disposed=!0}},{key:"ensureResources",value:function(e){return 0===this._numLoading?l.f.LOADED:l.f.LOADING}},{key:"textureBindParameters",get:function(){return new h(Object(c.k)(this._texture)?this._texture.glTexture:null,Object(c.k)(this._textureNormal)?this._textureNormal.glTexture:null,Object(c.k)(this._textureEmissive)?this._textureEmissive.glTexture:null,Object(c.k)(this._textureOcclusion)?this._textureOcclusion.glTexture:null,Object(c.k)(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}},{key:"updateTexture",value:function(e){var t=this;(Object(c.j)(this._texture)||e!==this._texture.id)&&(this._texture=Object(c.o)(this._texture),this._textureId=e,this._acquire(this._textureId,(function(e){return t._texture=e})))}},{key:"_acquire",value:function(e,t){var n=this;if(Object(c.j)(e))t(null);else{var r=this._textureRepository.acquire(e);if(Object(s.l)(r))return++this._numLoading,void r.then((function(e){if(n._disposed)return Object(c.o)(e),void t(null);t(e)})).finally((function(){return--n._numLoading}));t(r)}}}]),n}(d),h=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return Object(r.a)(this,n),(e=t.call(this)).texture=a,e.textureNormal=i,e.textureEmissive=o,e.textureOcclusion=c,e.textureMetallicRoughness=s,e}return Object(a.a)(n)}(u.a)},1093:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r,a,i,o,c=n(32),s=n(451),u=n(496),l=n(230);function d(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(l.b)(r||(r=Object(c.a)(["#ifndef GL_EXT_shader_texture_lod\nfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\nfloat deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\nreturn max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n#endif\nvec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n#else\nvec2 dUVdxAuto = dFdx(uvAtlas);\nvec2 dUVdyAuto = dFdy(uvAtlas);\nfloat mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\nfloat autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\nreturn texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}"]))))}function f(e,t){switch(e.include(u.a,t),e.fragment.code.add(Object(l.b)(a||(a=Object(c.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),t.textureCoordinateType){case u.b.Default:return void e.fragment.code.add(Object(l.b)(i||(i=Object(c.a)(["vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {\nreturn texture2D(texture, params.uv);\n}"]))));case u.b.Atlas:return e.include(d),void e.fragment.code.add(Object(l.b)(o||(o=Object(c.a)(["vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {\nreturn textureAtlasLookup(texture, params.size, params.uv, vuvRegion);\n}"]))));default:Object(s.a)(t.textureCoordinateType);case u.b.None:case u.b.COUNT:return}}},1094:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(146),s=n(216),u=n(229),l=n(362),d=n(322),f=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"vec2",d.a.Draw,(function(t,n,a){return t.setUniform2fv(e,r(n,a))}))}return Object(r.a)(n)}(l.a),h=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"sampler2D",d.a.Draw,(function(t,n,a){return t.bindTexture(e,r(n,a))}))}return Object(r.a)(n)}(l.a);function v(e,t,n){var r=[new h(e,t)];if(n){var a=e+"Size";r.push(new f(a,(function(e,n){var r=t(e,n);return Object(c.k)(r)?Object(s.a)(b,r.descriptor.width,r.descriptor.height):u.a})))}return r}var b=Object(u.b)()},1221:function(e,t,n){"use strict";n.r(t),n.d(t,"fetch",(function(){return jn})),n.d(t,"gltfToEngineResources",(function(){return An})),n.d(t,"parseUrl",(function(){return yn}));var r=n(60),a=n(5),i=n(155),o=n(154),c=n.n(o),s=n(319),u=n(146),l=n(206),d=n(334),f=n(396),h=n(349),v=n(222),b=n(209),p=n(413),m=n(444),g=n(572),O=n(1045),_=n(1074),x=n(1046),j=n(1065),T=n(1047),y=n(188),A=n(470),M=n(159),S=n(157),w=n(164),E=n(701),C=n(726),I=n(344),R=n(14),P=n(142),N=n(143),L=n(144),D=n(145),k=n(499),F=n(515),B=function(){function e(t,n,r,a){Object(P.a)(this,e),this.primitiveIndices=t,this._numIndexPerPrimitive=n,this.indices=r,this.position=a,this.center=Object(b.e)(),Object(F.a)(t.length>=1),Object(F.a)(r.length%this._numIndexPerPrimitive==0),Object(F.a)(r.length>=t.length*this._numIndexPerPrimitive),Object(F.a)(3===a.size||4===a.size);var i=a.data,o=a.size,c=t.length,s=o*r[this._numIndexPerPrimitive*t[0]];z.clear(),z.push(s),this.bbMin=Object(b.g)(i[s],i[s+1],i[s+2]),this.bbMax=Object(b.c)(this.bbMin);for(var u=0;u<c;++u)for(var l=this._numIndexPerPrimitive*t[u],d=0;d<this._numIndexPerPrimitive;++d){s=o*r[l+d],z.push(s);var f=i[s];this.bbMin[0]=Math.min(f,this.bbMin[0]),this.bbMax[0]=Math.max(f,this.bbMax[0]),f=i[s+1],this.bbMin[1]=Math.min(f,this.bbMin[1]),this.bbMax[1]=Math.max(f,this.bbMax[1]),f=i[s+2],this.bbMin[2]=Math.min(f,this.bbMin[2]),this.bbMax[2]=Math.max(f,this.bbMax[2])}Object(v.j)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);for(var h=this.radius*this.radius,p=0;p<z.length;++p){var m=i[s=z.getItemAt(p)]-this.center[0],g=i[s+1]-this.center[1],O=i[s+2]-this.center[2],_=m*m+g*g+O*O;if(!(_<=h)){var x=Math.sqrt(_),j=.5*(x-this.radius);this.radius=this.radius+j,h=this.radius*this.radius;var T=j/x;this.center[0]+=m*T,this.center[1]+=g*T,this.center[2]+=O*T}}z.clear()}return Object(N.a)(e,[{key:"getCenter",value:function(){return this.center}},{key:"getBSRadius",value:function(){return this.radius}},{key:"getBBMin",value:function(){return this.bbMin}},{key:"getBBMax",value:function(){return this.bbMax}},{key:"getChildren",value:function(){if(this._children)return this._children;if(Object(v.f)(this.bbMin,this.bbMax)>1){for(var t=Object(v.j)(Object(b.e)(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,r=new Uint8Array(n),a=new Array(8),i=0;i<8;++i)a[i]=0;for(var o=this.position,c=o.data,s=o.size,u=0;u<n;++u){for(var l=0,d=this._numIndexPerPrimitive*this.primitiveIndices[u],f=s*this.indices[d],h=c[f],p=c[f+1],m=c[f+2],g=1;g<this._numIndexPerPrimitive;++g){var O=c[f=s*this.indices[d+g]],_=c[f+1],x=c[f+2];O<h&&(h=O),_<p&&(p=_),x<m&&(m=x)}h<t[0]&&(l|=1),p<t[1]&&(l|=2),m<t[2]&&(l|=4),r[u]=l,++a[l]}for(var j=0,T=0;T<8;++T)a[T]>0&&++j;if(j<2)return;for(var y=new Array(8),A=0;A<8;++A)y[A]=a[A]>0?new Uint32Array(a[A]):void 0;for(var M=0;M<8;++M)a[M]=0;for(var S=0;S<n;++S){var w=r[S];y[w][a[w]++]=this.primitiveIndices[S]}this._children=new Array(8);for(var E=0;E<8;++E)void 0!==y[E]&&(this._children[E]=new e(y[E],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}}],[{key:"prune",value:function(){z.prune()}}]),e}(),z=new k.a({deallocator:null}),U=n(882),V=n(883),G=n(915),H=n(299),W=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I.e.Triangle,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;Object(P.a)(this,n),(i=t.call(this))._primitiveType=c,i.edgeIndicesLength=s,i.type=V.a.Geometry,i._vertexAttributes=new Map,i._indices=new Map,i._boundingInfo=null;var u,l=Object(r.a)(e);try{for(l.s();!(u=l.n()).done;){var d=Object(R.a)(u.value,2),f=d[0],h=d[1];h&&i._vertexAttributes.set(f,Object(a.a)({},h))}}catch(y){l.e(y)}finally{l.f()}if(null==o||0===o.length){var v=q(i._vertexAttributes),b=Object(G.c)(v);i.edgeIndicesLength=i.edgeIndicesLength<0?v:i.edgeIndicesLength;var p,m=Object(r.a)(i._vertexAttributes.keys());try{for(m.s();!(p=m.n()).done;){var g=p.value;i._indices.set(g,b)}}catch(y){m.e(y)}finally{m.f()}}else{var O,_=Object(r.a)(o);try{for(_.s();!(O=_.n()).done;){var x=Object(R.a)(O.value,2),j=x[0],T=x[1];T&&(i._indices.set(j,X(T)),j===H.a.POSITION&&(i.edgeIndicesLength=i.edgeIndicesLength<0?i._indices.get(j).length:i.edgeIndicesLength))}}catch(y){_.e(y)}finally{_.f()}}return i}return Object(N.a)(n,[{key:"cloneShallow",value:function(){var e=new n([],void 0,this._primitiveType,void 0),t=e._vertexAttributes,r=e._indices;return this._vertexAttributes.forEach((function(e,n){t.set(n,e)})),this._indices.forEach((function(e,t){r.set(t,e)})),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}},{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"getMutableAttribute",value:function(e){var t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){var e=this._indices.values().next().value;return e?e.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){return Object(u.j)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}},{key:"computeAttachmentOrigin",value:function(e){return this.primitiveType===I.e.Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}},{key:"_computeAttachmentOriginTriangles",value:function(e){var t=this.indices.get(H.a.POSITION),n=this.vertexAttributes.get(H.a.POSITION);return Object(G.b)(n,t,e)}},{key:"_computeAttachmentOriginPoints",value:function(e){var t=this.indices.get(H.a.POSITION),n=this.vertexAttributes.get(H.a.POSITION);return Object(G.a)(n,t,e)}},{key:"invalidateBoundingInfo",value:function(){this._boundingInfo=null}},{key:"_calculateBoundingInfo",value:function(){var e=this.indices.get(H.a.POSITION);if(0===e.length)return null;var t=this.primitiveType===I.e.Triangle?3:1;Object(F.a)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);var n=Object(G.c)(e.length/t),r=this.vertexAttributes.get(H.a.POSITION);return new B(n,t,e,r)}}]),n}(U.a);function q(e){var t=e.values().next().value;return null==t?0:t.data.length/t.size}function X(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){if(t.value>=65536)return e}}catch(a){n.e(a)}finally{n.f()}return new Uint16Array(e)}var K,Y,Z,Q=n(451),J=n(252),$=n(185),ee=n(484),te=n(187),ne=n(960),re=n(333);function ae(){if(Object(u.j)(K)){var e=function(e){return Object(re.a)("esri/libs/basisu/".concat(e))};K=Promise.all([n.e(125),n.e(118)]).then(n.bind(null,1345)).then((function(e){return e.b})).then((function(t){return(0,t.default)({locateFile:e}).then((function(e){return e.initializeBasis(),delete e.then,e}))}))}return K}(Z=Y||(Y={}))[Z.ETC1_RGB=0]="ETC1_RGB",Z[Z.ETC2_RGBA=1]="ETC2_RGBA",Z[Z.BC1_RGB=2]="BC1_RGB",Z[Z.BC3_RGBA=3]="BC3_RGBA",Z[Z.BC4_R=4]="BC4_R",Z[Z.BC5_RG=5]="BC5_RG",Z[Z.BC7_M6_RGB=6]="BC7_M6_RGB",Z[Z.BC7_M5_RGBA=7]="BC7_M5_RGBA",Z[Z.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",Z[Z.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",Z[Z.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",Z[Z.ATC_RGB=11]="ATC_RGB",Z[Z.ATC_RGBA=12]="ATC_RGBA",Z[Z.FXT1_RGB=17]="FXT1_RGB",Z[Z.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",Z[Z.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",Z[Z.ETC2_EAC_R11=20]="ETC2_EAC_R11",Z[Z.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",Z[Z.RGBA32=13]="RGBA32",Z[Z.RGB565=14]="RGB565",Z[Z.BGR565=15]="BGR565",Z[Z.RGBA4444=16]="RGBA4444";var ie=n(153),oe=n(182),ce=n(625),se=null,ue=null;function le(){return de.apply(this,arguments)}function de(){return(de=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(u.j)(ue),!e.t0){e.next=6;break}return ue=ae(),e.next=5,ue;case 5:se=e.sent;case 6:return e.abrupt("return",ue);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e,t,n,r,a){var i=Object(ce.b)(t?ie.i.COMPRESSED_RGBA8_ETC2_EAC:ie.i.COMPRESSED_RGB8_ETC2),o=a&&e>1?(Math.pow(4,e)-1)/(3*Math.pow(4,e-1)):1;return Math.ceil(n*r*i*o)}function he(e){return e.getNumImages()>=1&&!e.isUASTC()}function ve(e){return e.getFaces()>=1&&e.isETC1S()}function be(){return(be=Object(i.a)(c.a.mark((function e(t,n,r){var a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(u.j)(se),!e.t0){e.next=5;break}return e.next=4,le();case 4:se=e.sent;case 5:if(he(a=new se.BasisFile(new Uint8Array(r)))){e.next=8;break}return e.abrupt("return",null);case 8:return a.startTranscoding(),i=me(t,n,a.getNumLevels(0),a.getHasAlpha(),a.getImageWidth(0,0),a.getImageHeight(0,0),(function(e,t){return a.getImageTranscodedSizeInBytes(0,e,t)}),(function(e,t,n){return a.transcodeImage(n,0,e,t,0,0)})),e.abrupt("return",(a.close(),a.delete(),i));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(){return(pe=Object(i.a)(c.a.mark((function e(t,n,r){var a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(u.j)(se),!e.t0){e.next=5;break}return e.next=4,le();case 4:se=e.sent;case 5:if(ve(a=new se.KTX2File(new Uint8Array(r)))){e.next=8;break}return e.abrupt("return",null);case 8:return a.startTranscoding(),i=me(t,n,a.getLevels(),a.getHasAlpha(),a.getWidth(),a.getHeight(),(function(e,t){return a.getImageTranscodedSizeInBytes(e,0,0,t)}),(function(e,t,n){return a.transcodeImage(n,e,0,0,t,0,-1,-1)})),e.abrupt("return",(a.close(),a.delete(),i));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e,t,n,r,i,o,c,s){for(var u=e.capabilities,l=u.compressedTextureETC,d=u.compressedTextureS3TC,f=l?r?[Y.ETC2_RGBA,ie.i.COMPRESSED_RGBA8_ETC2_EAC]:[Y.ETC1_RGB,ie.i.COMPRESSED_RGB8_ETC2]:d?r?[Y.BC3_RGBA,ie.i.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Y.BC1_RGB,ie.i.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Y.RGBA32,ie.p.RGBA],h=Object(R.a)(f,2),v=h[0],b=h[1],p=t.hasMipmap?n:Math.min(1,n),m=[],g=0;g<p;g++)m.push(new Uint8Array(c(g,v))),s(g,v,m[g]);var O=m.length>1,_=O?ie.z.LINEAR_MIPMAP_LINEAR:ie.z.LINEAR,x=Object(a.a)(Object(a.a)({},t),{},{samplingMode:_,hasMipmap:O,internalFormat:b,width:i,height:o});return new oe.a(e,x,{type:"compressed",levels:m})}var ge=S.a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Oe=542327876,_e=131072;function xe(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var je=xe("DXT1"),Te=xe("DXT3"),ye=xe("DXT5");function Ae(e,t,n){var r=function(e,t){var n=new Int32Array(e,0,31);if(n[0]!==Oe)return ge.error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return ge.error("Unsupported format, must contain a FourCC code"),null;var r,a,i=n[21];switch(i){case je:r=8,a=ie.i.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Te:r=16,a=ie.i.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ye:r=16,a=ie.i.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return ge.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}var o=1,c=n[4],s=n[3];0==(3&c)&&0==(3&s)||(ge.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,s=s+3&-4);var u,l,d=c,f=s;n[2]&_e&&!1!==t&&(o=Math.max(1,n[7])),1===o||Object($.h)(c)&&Object($.h)(s)||(ge.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);for(var h=n[1]+4,v=[],b=0;b<o;++b)l=(c+3>>2)*(s+3>>2)*r,u=new Uint8Array(e,h,l),v.push(u),h+=l,c=Math.max(1,c>>1),s=Math.max(1,s>>1);return{textureData:{type:"compressed",levels:v},internalFormat:a,width:d,height:f}}(n,t.hasMipmap),a=r.textureData,i=r.internalFormat,o=r.width,c=r.height;return t.samplingMode=a.levels.length>1?ie.z.LINEAR_MIPMAP_LINEAR:ie.z.LINEAR,t.hasMipmap=a.levels.length>1,t.internalFormat=i,t.width=o,t.height=c,new oe.a(e,t,a)}var Me=n(884),Se=n(224),we=(new Se.a(H.a.POSITION,3,ie.k.FLOAT,0,12),new Se.a(H.a.POSITION,3,ie.k.FLOAT,0,20),new Se.a(H.a.UV0,2,ie.k.FLOAT,12,20),new Se.a(H.a.POSITION,3,ie.k.FLOAT,0,32),new Se.a(H.a.NORMAL,3,ie.k.FLOAT,12,32),new Se.a(H.a.UV0,2,ie.k.FLOAT,24,32),new Se.a(H.a.POSITION,3,ie.k.FLOAT,0,16),new Se.a(H.a.COLOR,4,ie.k.UNSIGNED_BYTE,12,16),[new Se.a(H.a.POSITION,2,ie.k.FLOAT,0,8)]),Ee=[new Se.a(H.a.POSITION,2,ie.k.FLOAT,0,16),new Se.a(H.a.UV0,2,ie.k.FLOAT,8,16)],Ce=n(173),Ie=n(174);var Re,Pe,Ne=n(204),Le=n(422),De=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(e,r){var a;return Object(P.a)(this,n),(a=t.call(this)).data=e,a.type=V.a.Texture,a._glTexture=null,a._powerOfTwoStretchInfo=null,a._loadingPromise=null,a._loadingController=null,a.events=new J.a,a.params=r||{},a.params.mipmap=!1!==a.params.mipmap,a.params.noUnpackFlip=a.params.noUnpackFlip||!1,a.params.preMultiplyAlpha=a.params.preMultiplyAlpha||!1,a.params.wrap=a.params.wrap||{s:ie.B.REPEAT,t:ie.B.REPEAT},a.params.powerOfTwoResizeMode=a.params.powerOfTwoResizeMode||I.d.STRETCH,a.estimatedTexMemRequired=n._estimateTexMemRequired(a.data,a.params),a._startPreload(),a}return Object(N.a)(n,[{key:"_startPreload",value:function(){var e=this.data;Object(u.j)(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}},{key:"_startPreloadVideoElement",value:function(e){if(!(Object(te.v)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";var t=!e.paused;if(e.src=e.src,t&&e.autoplay){e.addEventListener("canplay",(function t(){e.removeEventListener("canplay",t),e.play()}))}}}},{key:"_startPreloadImageElement",value:function(e){Object(te.w)(e.src)||Object(te.v)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}},{key:"dispose",value:function(){this.data=void 0}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"_createDescriptor",value:function(e){var t;return{target:ie.A.TEXTURE_2D,pixelFormat:ie.p.RGBA,dataType:ie.q.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?ie.z.LINEAR_MIPMAP_LINEAR:ie.z.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!==(t=this.params.maxAnisotropy)&&void 0!==t?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}},{key:"glTexture",get:function(){return this._glTexture}},{key:"load",value:function(e,t){if(Object(u.k)(this._glTexture))return this._glTexture;if(Object(u.k)(this._loadingPromise))return this._loadingPromise;var r=this.data;return Object(u.j)(r)?(this._glTexture=new oe.a(e,this._createDescriptor(e),null),this._glTexture):"string"==typeof r?this._loadFromURL(e,t,r):r instanceof Image?this._loadFromImageElement(e,t,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,t,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r,t):(Object(ee.c)(r)||Object(ee.k)(r))&&this.params.encoding===n.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(e,r)):(Object(ee.c)(r)||Object(ee.k)(r))&&this.params.encoding===n.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(e,r)):(Object(ee.c)(r)||Object(ee.k)(r))&&this.params.encoding===n.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(e,r)):Object(ee.k)(r)?this._loadFromPixelData(e,r):Object(ee.c)(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}},{key:"frameUpdate",value:function(e,t,n){if(!(this.data instanceof HTMLVideoElement)||Object(u.j)(this._glTexture))return n;if(this.data.readyState<Re.HAVE_CURRENT_DATA||n===this.data.currentTime)return n;if(Object(u.k)(this._powerOfTwoStretchInfo)){var r=this._powerOfTwoStretchInfo,a=r.framebuffer,i=r.vao,o=r.sourceTexture;o.setData(this.data),this._drawStretchedTexture(e,t,a,i,o,this._glTexture)}else{var c=this.data,s=c.videoWidth,l=c.videoHeight,d=this._glTexture.descriptor,f=d.width,h=d.height;s!==f||l!==h?this._glTexture.updateData(0,0,0,Math.min(s,f),Math.min(l,h),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}},{key:"_loadFromDDSData",value:function(e,t){return this._glTexture=Ae(e,this._createDescriptor(e),t),this._glTexture}},{key:"_loadFromKTX2",value:function(e,t){var n=this;return this._loadAsync((function(){return function(e,t,n){return pe.apply(this,arguments)}(e,n._createDescriptor(e),t).then((function(e){return n._glTexture=e,e}))}))}},{key:"_loadFromBasis",value:function(e,t){var n=this;return this._loadAsync((function(){return function(e,t,n){return be.apply(this,arguments)}(e,n._createDescriptor(e),t).then((function(e){return n._glTexture=e,e}))}))}},{key:"_loadFromPixelData",value:function(e,t){Object(F.a)(this.params.width>0&&this.params.height>0);var n=this._createDescriptor(e);return n.pixelFormat=1===this.params.components?ie.p.LUMINANCE:3===this.params.components?ie.p.RGB:ie.p.RGBA,n.width=this.params.width,n.height=this.params.height,this._glTexture=new oe.a(e,n,t),this._glTexture}},{key:"_loadFromURL",value:function(e,t,n){var r=this;return this._loadAsync(function(){var a=Object(i.a)(c.a.mark((function a(i){var o;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(C.a)(n,{signal:i});case 2:return o=a.sent,a.abrupt("return",(Object(w.p)(i),r._loadFromImage(e,o,t)));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"_loadFromImageElement",value:function(e,t,n){var r=this;return n.complete?this._loadFromImage(e,n,t):this._loadAsync(function(){var a=Object(i.a)(c.a.mark((function a(i){var o;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(ne.b)(n,n.src,!1,i);case 2:return o=a.sent,a.abrupt("return",(Object(w.p)(i),r._loadFromImage(e,o,t)));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"_loadFromVideoElement",value:function(e,t,n){return n.readyState>=Re.HAVE_CURRENT_DATA?this._loadFromImage(e,n,t):this._loadFromVideoElementAsync(e,t,n)}},{key:"_loadFromVideoElementAsync",value:function(e,t,n){var r=this;return this._loadAsync((function(a){return new Promise((function(i,o){var c=function(){n.removeEventListener("loadeddata",s),n.removeEventListener("error",l),Object(u.p)(d)},s=function(){n.readyState>=Re.HAVE_CURRENT_DATA&&(c(),i(r._loadFromImage(e,n,t)))},l=function(e){c(),o(e||new M.a("Failed to load video"))};n.addEventListener("loadeddata",s),n.addEventListener("error",l);var d=Object(w.m)(a,(function(){return l(Object(w.b)())}))}))}))}},{key:"_loadFromImage",value:function(e,t,r){var a=n._getDataDimensions(t);this.params.width=a.width,this.params.height=a.height;var i=this._createDescriptor(e);return i.pixelFormat=3===this.params.components?ie.p.RGB:ie.p.RGBA,!this._requiresPowerOfTwo(e,i)||Object($.h)(a.width)&&Object($.h)(a.height)?(i.width=a.width,i.height=a.height,this._glTexture=new oe.a(e,i,t),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,t,a,i,r),this._glTexture)}},{key:"_loadAsync",value:function(e){var t=this,n=new AbortController;this._loadingController=n;var r=e(n.signal);this._loadingPromise=r;var a=function(){t._loadingController===n&&(t._loadingController=null),t._loadingPromise===r&&(t._loadingPromise=null)};return r.then(a,a),r}},{key:"_requiresPowerOfTwo",value:function(e,t){var n=ie.B.CLAMP_TO_EDGE,r="number"==typeof t.wrapMode?t.wrapMode===n:t.wrapMode.s===n&&t.wrapMode.t===n;return!Object(Le.a)(e.gl)&&(t.hasMipmap||!r)}},{key:"_makePowerOfTwoTexture",value:function(e,t,n,r,a){var i,o=n.width,c=n.height,s=Object($.j)(o),u=Object($.j)(c);switch(r.width=s,r.height=u,this.params.powerOfTwoResizeMode){case I.d.PAD:r.textureCoordinateScaleFactor=[o/s,c/u],(i=new oe.a(e,r)).updateData(0,0,0,o,c,t);break;case I.d.STRETCH:case null:case void 0:i=this._stretchToPowerOfTwo(e,t,r,a());break;default:Object(Q.a)(this.params.powerOfTwoResizeMode)}return r.hasMipmap&&i.generateMipmap(),i}},{key:"_stretchToPowerOfTwo",value:function(e,t,n,r){var a=new oe.a(e,n),i=new Ne.a(e,{colorTarget:ie.y.TEXTURE,depthStencilTarget:ie.m.NONE},a),o=new oe.a(e,{target:ie.A.TEXTURE_2D,pixelFormat:n.pixelFormat,dataType:ie.q.UNSIGNED_BYTE,wrapMode:ie.B.CLAMP_TO_EDGE,samplingMode:ie.z.LINEAR,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:we,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me.a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=null;return i=t===Ee?new Float32Array([r,r,0,0,a,r,1,0,r,a,0,1,a,a,1,1]):new Float32Array([r,r,a,r,r,a,a,a]),new Ie.a(e,n,{geometry:t},{geometry:Ce.a.createVertex(e,ie.D.STATIC_DRAW,i)})}(e),s=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,r,i,c,o,a),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:c,sourceTexture:o,framebuffer:i}:(c.dispose(!0),o.dispose(),i.detachColorTexture(),i.dispose()),e.bindFramebuffer(s),a}},{key:"_drawStretchedTexture",value:function(e,t,n,r,a,i){e.bindFramebuffer(n);var o=e.getViewport();e.setViewport(0,0,i.descriptor.width,i.descriptor.height);var c=e.bindTechnique(t);c.setUniform4f("uColor",1,1,1,1),c.bindTexture("tex",a),e.bindVAO(r),e.drawArrays(ie.r.TRIANGLE_STRIP,0,Object(ce.f)(r,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)}},{key:"unload",value:function(){if(Object(u.k)(this._powerOfTwoStretchInfo)){var e=this._powerOfTwoStretchInfo,t=e.framebuffer,n=e.vao,r=e.sourceTexture;n.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(u.k)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(u.k)(this._loadingController)){var a=this._loadingController;this._loadingController=null,this._loadingPromise=null,a.abort()}this.events.emit("unloaded")}}],[{key:"_getDataDimensions",value:function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}},{key:"_estimateTexMemRequired",value:function(e,t){if(Object(u.j)(e))return 0;if(Object(ee.c)(e)||Object(ee.k)(e))return t.encoding===n.KTX2_ENCODING?function(e,t){if(Object(u.j)(se))return e.byteLength;var n=new se.KTX2File(new Uint8Array(e)),r=ve(n)?fe(n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),t):0;return n.close(),n.delete(),r}(e,t.mipmap):t.encoding===n.BASIS_ENCODING?function(e,t){if(Object(u.j)(se))return e.byteLength;var n=new se.BasisFile(new Uint8Array(e)),r=he(n)?fe(n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),t):0;return n.close(),n.delete(),r}(e,t.mipmap):e.byteLength;var r=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?n._getDataDimensions(e):t,a=r.width,i=r.height;return(t.mipmap?4/3:1)*a*i*(t.components||4)||0}}]),n}(U.a);De.DDS_ENCODING="image/vnd-ms.dds",De.KTX2_ENCODING="image/ktx2",De.BASIS_ENCODING="image/x.basis",(Pe=Re||(Re={}))[Pe.HAVE_NOTHING=0]="HAVE_NOTHING",Pe[Pe.HAVE_METADATA=1]="HAVE_METADATA",Pe[Pe.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",Pe[Pe.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",Pe[Pe.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA";var ke,Fe,Be,ze,Ue=n(162),Ve=n(161),Ge=n(710),He=n(490),We=n(442),qe=n(501),Xe=n(580),Ke=n(495),Ye=n(1092),Ze=n(885),Qe=n(725);(Fe=ke||(ke={}))[Fe.MATERIAL=0]="MATERIAL",Fe[Fe.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",Fe[Fe.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",Fe[Fe.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",Fe[Fe.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",Fe[Fe.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",Fe[Fe.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",Fe[Fe.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT",(ze=Be||(Be={}))[ze.INTEGRATED_MESH=0]="INTEGRATED_MESH",ze[ze.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",ze[ze.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",ze[ze.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",ze[ze.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",ze[ze.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",ze[ze.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",ze[ze.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",ze[ze.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",ze[ze.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",ze[ze.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",ze[ze.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",ze[ze.LASERLINES=12]="LASERLINES",ze[ze.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",ze[ze.HUD_MATERIAL=14]="HUD_MATERIAL",ze[ze.LABEL_MATERIAL=15]="LABEL_MATERIAL",ze[ze.LINE_CALLOUTS=16]="LINE_CALLOUTS",ze[ze.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",ze[ze.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",ze[ze.DRAPED_WATER=19]="DRAPED_WATER",ze[ze.VOXEL=20]="VOXEL",ze[ze.MAX_SLOTS=21]="MAX_SLOTS";var Je=n(514),$e=n(406),et=n(331),tt=n(546),nt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(P.a)(this,e),this.offset=t,this.tmpVertex=Object(b.e)()}return Object(N.a)(e,[{key:"applyToVertex",value:function(e,t,n){var r=e+this.localOrigin[0],a=t+this.localOrigin[1],i=n+this.localOrigin[2],o=this.offset/Math.sqrt(r*r+a*a+i*i);return this.tmpVertex[0]=e+r*o,this.tmpVertex[1]=t+a*o,this.tmpVertex[2]=n+i*o,this.tmpVertex}},{key:"applyToAabb",value:function(e){for(var t=this,n=0;n<3;++n)rt[n]=e[0+n]+this.localOrigin[n],at[n]=e[3+n]+this.localOrigin[n],it[n]=rt[n];for(var r=this.applyToVertex(rt[0],rt[1],rt[2]),a=0;a<3;++a)e[a]=r[a],e[a+3]=r[a];for(var i=function(n){for(var r=t.applyToVertex(n[0],n[1],n[2]),a=0;a<3;++a)e[a+0]=Math.min(e[a+0],r[a]),e[a+3]=Math.max(e[a+3],r[a])},o=1;o<8;++o){for(var c=0;c<3;++c)it[c]=0==(o&1<<c)?rt[c]:at[c];i(it)}for(var s=0,u=0;u<3;++u)rt[u]*at[u]<0&&(s|=1<<u);if(0!==s&&7!==s)for(var l=0;l<8;++l)if(0==(s&l)){for(var d=0;d<3;++d)s[d]?it[d]=0:it[d]=0!=(l&1<<d)?rt[d]:at[d];i(it)}for(var f=0;f<3;++f)e[f+0]-=this.localOrigin[f],e[f+3]-=this.localOrigin[f];return e}}]),e}(),rt=Object(b.e)(),at=Object(b.e)(),it=Object(b.e)(),ot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(P.a)(this,e),this.componentLocalOriginLength=0,this._tmpVertex=Object(b.e)(),this._mbs=Object(tt.b)(),this._obb={center:Object(b.e)(),halfSize:Object(et.a)(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}return Object(N.a)(e,[{key:"_resetOffset",value:function(e){this._offset=e,this._totalOffset=e}},{key:"offset",get:function(){return this._offset},set:function(e){this._resetOffset(e)}},{key:"componentOffset",set:function(e){this._totalOffset=this._offset+e}},{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,n){var r=e,a=t,i=n+this.componentLocalOriginLength,o=this._totalOffset/Math.sqrt(r*r+a*a+i*i);return this._tmpVertex[0]=e+r*o,this._tmpVertex[1]=t+a*o,this._tmpVertex[2]=n+i*o,this._tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,a=e[3],i=e[4],o=e[5]+this.componentLocalOriginLength,c=t*a<0?0:Math.min(Math.abs(t),Math.abs(a)),s=n*i<0?0:Math.min(Math.abs(n),Math.abs(i)),u=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),l=Math.sqrt(c*c+s*s+u*u);if(l<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=n<0?this._totalOffset:0,e[2]-=r<0?this._totalOffset:0,e[3]+=a>0?this._totalOffset:0,e[4]+=i>0?this._totalOffset:0,e[5]+=o>0?this._totalOffset:0,e;var d=Math.max(Math.abs(t),Math.abs(a)),f=Math.max(Math.abs(n),Math.abs(i)),h=Math.max(Math.abs(r),Math.abs(o)),v=Math.sqrt(d*d+f*f+h*h),b=this._totalOffset/v,p=this._totalOffset/l;return e[0]+=t*(t>0?b:p),e[1]+=n*(n>0?b:p),e[2]+=r*(r>0?b:p),e[3]+=a*(a<0?b:p),e[4]+=i*(i<0?b:p),e[5]+=o*(o<0?b:p),e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*n,this._mbs[1]=e[1]+e[1]*n,this._mbs[2]=e[2]+e[2]*n,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}},{key:"applyToObb",value:function(e){var t=e.center,n=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*n,this._obb.center[1]=t[1]+t[1]*n,this._obb.center[2]=t[2]+t[2]*n,Object(v.s)(this._obb.halfSize,e.halfSize,e.quaternion),Object(v.c)(this._obb.halfSize,this._obb.halfSize,e.center);var r=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*r,this._obb.halfSize[1]+=this._obb.halfSize[1]*r,this._obb.halfSize[2]+=this._obb.halfSize[2]*r,Object(v.d)(this._obb.halfSize,this._obb.halfSize,e.center),Object(Je.a)(ut,e.quaternion),Object(v.s)(this._obb.halfSize,this._obb.halfSize,ut),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}}]),e}(),ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(P.a)(this,e),this.offset=t,this.sphere=Object(tt.b)(),this.tmpVertex=Object(b.e)()}return Object(N.a)(e,[{key:"applyToVertex",value:function(e,t,n){var r=this.objectTransform.transform,a=r[0]*e+r[4]*t+r[8]*n+r[12],i=r[1]*e+r[5]*t+r[9]*n+r[13],o=r[2]*e+r[6]*t+r[10]*n+r[14],c=this.offset/Math.sqrt(a*a+i*i+o*o);a+=a*c,i+=i*c,o+=o*c;var s=this.objectTransform.inverse;return this.tmpVertex[0]=s[0]*a+s[4]*i+s[8]*o+s[12],this.tmpVertex[1]=s[1]*a+s[5]*i+s[9]*o+s[13],this.tmpVertex[2]=s[2]*a+s[6]*i+s[10]*o+s[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.sphere[0]=e[0]+e[0]*n,this.sphere[1]=e[1]+e[1]*n,this.sphere[2]=e[2]+e[2]*n,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}(),st=new ct;new ot;new nt;var ut=Object($e.b)();function lt(e,t,n,r){var a=n.typedBuffer,i=n.typedBufferStride,o=e.length;r*=i;for(var c=0;c<o;++c){var s=2*e[c];a[r]=t[s],a[r+1]=t[s+1],r+=i}}function dt(e,t,n,r,a){var i=n.typedBuffer,o=n.typedBufferStride,c=e.length;if(r*=o,null==a||1===a)for(var s=0;s<c;++s){var u=3*e[s];i[r]=t[u],i[r+1]=t[u+1],i[r+2]=t[u+2],r+=o}else for(var l=0;l<c;++l)for(var d=3*e[l],f=0;f<a;++f)i[r]=t[d],i[r+1]=t[d+1],i[r+2]=t[d+2],r+=o}function ft(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=n.typedBuffer,o=n.typedBufferStride,c=e.length;if(r*=o,1===a)for(var s=0;s<c;++s){var u=4*e[s];i[r]=t[u],i[r+1]=t[u+1],i[r+2]=t[u+2],i[r+3]=t[u+3],r+=o}else for(var l=0;l<c;++l)for(var d=4*e[l],f=0;f<a;++f)i[r]=t[d],i[r+1]=t[d+1],i[r+2]=t[d+2],i[r+3]=t[d+3],r+=o}function ht(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(n){var o=r.typedBuffer,c=r.typedBufferStride,s=e.length,u=n[0],l=n[1],d=n[2],f=n[4],h=n[5],v=n[6],b=n[8],p=n[9],m=n[10],g=n[12],O=n[13],_=n[14];if(a*=c,1===i)for(var x=0;x<s;++x){var j=3*e[x],T=t[j],y=t[j+1],A=t[j+2];o[a]=u*T+f*y+b*A+g,o[a+1]=l*T+h*y+p*A+O,o[a+2]=d*T+v*y+m*A+_,a+=c}else for(var M=0;M<s;++M)for(var S=3*e[M],w=t[S],E=t[S+1],C=t[S+2],I=u*w+f*E+b*C+g,R=l*w+h*E+p*C+O,P=d*w+v*E+m*C+_,N=0;N<i;++N)o[a]=I,o[a+1]=R,o[a+2]=P,a+=c}else dt(e,t,r,a,i)}function vt(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(n){var o=n,c=r.typedBuffer,s=r.typedBufferStride,u=e.length,l=o[0],d=o[1],h=o[2],v=o[4],b=o[5],p=o[6],m=o[8],g=o[9],O=o[10],_=!Object(f.j)(o),x=1e-6,j=1-x;if(a*=s,1===i)for(var T=0;T<u;++T){var y=3*e[T],A=t[y],M=t[y+1],S=t[y+2],w=l*A+v*M+m*S,E=d*A+b*M+g*S,C=h*A+p*M+O*S;if(_){var I=w*w+E*E+C*C;if(I<j&&I>x){var R=1/Math.sqrt(I);w*=R,E*=R,C*=R}}c[a+0]=w,c[a+1]=E,c[a+2]=C,a+=s}else for(var P=0;P<u;++P){var N=3*e[P],L=t[N],D=t[N+1],k=t[N+2],F=l*L+v*D+m*k,B=d*L+b*D+g*k,z=h*L+p*D+O*k;if(_){var U=F*F+B*B+z*z;if(U<j&&U>x){var V=1/Math.sqrt(U);F*=V,B*=V,z*=V}}for(var G=0;G<i;++G)c[a+0]=F,c[a+1]=B,c[a+2]=z,a+=s}}else dt(e,t,r,a,i)}function bt(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(n){var o=n,c=r.typedBuffer,s=r.typedBufferStride,u=e.length,l=o[0],d=o[1],h=o[2],v=o[4],b=o[5],p=o[6],m=o[8],g=o[9],O=o[10],_=!Object(f.j)(o),x=1e-6,j=1-x;if(a*=s,1===i)for(var T=0;T<u;++T){var y=4*e[T],A=t[y],M=t[y+1],S=t[y+2],w=t[y+3],E=l*A+v*M+m*S,C=d*A+b*M+g*S,I=h*A+p*M+O*S;if(_){var R=E*E+C*C+I*I;if(R<j&&R>x){var P=1/Math.sqrt(R);E*=P,C*=P,I*=P}}c[a+0]=E,c[a+1]=C,c[a+2]=I,c[a+3]=w,a+=s}else for(var N=0;N<u;++N){var L=4*e[N],D=t[L],k=t[L+1],F=t[L+2],B=t[L+3],z=l*D+v*k+m*F,U=d*D+b*k+g*F,V=h*D+p*k+O*F;if(_){var G=z*z+U*U+V*V;if(G<j&&G>x){var H=1/Math.sqrt(G);z*=H,U*=H,V*=H}}for(var W=0;W<i;++W)c[a+0]=z,c[a+1]=U,c[a+2]=V,c[a+3]=B,a+=s}}else ft(e,t,r,a,i)}function pt(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=r.typedBuffer,c=r.typedBufferStride,s=e.length;if(a*=c,1===i){if(4===n)for(var u=0;u<s;++u){var l=4*e[u];o[a]=t[l],o[a+1]=t[l+1],o[a+2]=t[l+2],o[a+3]=t[l+3],a+=c}else if(3===n)for(var d=0;d<s;++d){var f=3*e[d];o[a]=t[f],o[a+1]=t[f+1],o[a+2]=t[f+2],o[a+3]=255,a+=c}}else if(4===n)for(var h=0;h<s;++h)for(var v=4*e[h],b=0;b<i;++b)o[a]=t[v],o[a+1]=t[v+1],o[a+2]=t[v+2],o[a+3]=t[v+3],a+=c;else if(3===n)for(var p=0;p<s;++p)for(var m=3*e[p],g=0;g<i;++g)o[a]=t[m],o[a+1]=t[m+1],o[a+2]=t[m+2],o[a+3]=255,a+=c}var mt=n(901),gt=n(366),Ot=n(496),_t=n(740),xt=n(581),jt=n(886),Tt=function(){function e(t,n){Object(P.a)(this,e),this._module=t,this._loadModule=n}return Object(N.a)(e,[{key:"get",value:function(){return this._module}},{key:"reload",value:function(){var e=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadModule();case 2:return this._module=e.sent,e.abrupt("return",this._module);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),yt=function(){function e(t,n,r){Object(P.a)(this,e),this.release=r,n&&(this.initializeConfiguration(t,n),this._configuration=n.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}return Object(N.a)(e,[{key:"destroy",value:function(){this._program=Object(u.e)(this._program),this._pipeline=this._configuration=null}},{key:"reload",value:function(e){Object(u.e)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}},{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.isCompiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},{key:"bindPass",value:function(e,t){this.program.bindPass(e,t)}},{key:"bindDraw",value:function(e,t){this.program.bindDraw(e,t),this.program.rebindTextures()}},{key:"bindPipelineState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;e.setPipelineState(this.getPipelineState(t,n))}},{key:"ensureAttributeLocations",value:function(e){this.program.assertCompatibleVertexAttributeLocations(e)}},{key:"primitiveType",get:function(){return ie.r.TRIANGLES}},{key:"getPipelineState",value:function(e,t){return this._pipeline}},{key:"initializeConfiguration",value:function(e,t){}}]),e}(),At=n(322),Mt=n(301),St=function(){function e(t,n,r){Object(P.a)(this,e),this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new k.a({deallocator:null}),this._glProgram=t.programCache.acquire(n.generate("vertex"),n.generate("fragment"),r),this._glProgram.stop=function(){throw new Error("Wrapped _glProgram used directly")},this.bindPass=n.generateBind(At.a.Pass,this),this.bindDraw=n.generateBind(At.a.Draw,this),this._fragmentUniforms=Object(Mt.b)()?n.fragmentUniforms:null}return Object(N.a)(e,[{key:"dispose",value:function(){this._glProgram.dispose()}},{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}},{key:"setUniform1b",value:function(e,t){this._glProgram.setUniform1i(e,t?1:0)}},{key:"setUniform1i",value:function(e,t){this._glProgram.setUniform1i(e,t)}},{key:"setUniform1f",value:function(e,t){this._glProgram.setUniform1f(e,t)}},{key:"setUniform2f",value:function(e,t,n){this._glProgram.setUniform2f(e,t,n)}},{key:"setUniform2fv",value:function(e,t){this._glProgram.setUniform2fv(e,t)}},{key:"setUniform3f",value:function(e,t,n,r){this._glProgram.setUniform3f(e,t,n,r)}},{key:"setUniform3fv",value:function(e,t){this._glProgram.setUniform3fv(e,t)}},{key:"setUniform4f",value:function(e,t,n,r,a){this._glProgram.setUniform4f(e,t,n,r,a)}},{key:"setUniform4fv",value:function(e,t){this._glProgram.setUniform4fv(e,t)}},{key:"setUniformMatrix3fv",value:function(e,t){this._glProgram.setUniformMatrix3fv(e,t)}},{key:"setUniformMatrix4fv",value:function(e,t){this._glProgram.setUniformMatrix4fv(e,t)}},{key:"setUniform1fv",value:function(e,t){this._glProgram.setUniform1fv(e,t)}},{key:"setUniform1iv",value:function(e,t){this._glProgram.setUniform1iv(e,t)}},{key:"setUniform2iv",value:function(e,t){this._glProgram.setUniform3iv(e,t)}},{key:"setUniform3iv",value:function(e,t){this._glProgram.setUniform3iv(e,t)}},{key:"setUniform4iv",value:function(e,t){this._glProgram.setUniform4iv(e,t)}},{key:"assertCompatibleVertexAttributeLocations",value:function(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}},{key:"stop",value:function(){this._textures.clear(),this._freeTextureUnits.clear()}},{key:"bindTexture",value:function(e,t){if(Object(u.j)(t)||null==t.glName){var n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}var r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}},{key:"rebindTextures",value:function(){var e=this;this._context.useProgram(this),this._textures.forEach((function(t,n){e._context.bindTexture(t.texture,t.unit),e.setUniform1i(n,t.unit)})),Object(u.k)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((function(t){"sampler2D"!==t.type&&"samplerCube"!==t.type||e._textures.has(t.name)||console.error("Texture sampler ".concat(t.name," has no bound texture"))}))}},{key:"_allocTextureUnit",value:function(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}},{key:"_freeTextureUnit",value:function(e){this._freeTextureUnits.push(e.unit)}}]),e}(),wt=(ie.h.LESS,ie.h.ALWAYS,{mask:255}),Et={function:{func:ie.h.ALWAYS,ref:I.g.OutlineVisualElementMask,mask:I.g.OutlineVisualElementMask},operation:{fail:ie.w.KEEP,zFail:ie.w.KEEP,zPass:ie.w.ZERO}},Ct={function:{func:ie.h.ALWAYS,ref:I.g.OutlineVisualElementMask,mask:I.g.OutlineVisualElementMask},operation:{fail:ie.w.KEEP,zFail:ie.w.KEEP,zPass:ie.w.REPLACE}},It=(ie.h.EQUAL,I.g.OutlineVisualElementMask,I.g.OutlineVisualElementMask,ie.w.KEEP,ie.w.KEEP,ie.w.KEEP,ie.h.NOTEQUAL,I.g.OutlineVisualElementMask,I.g.OutlineVisualElementMask,ie.w.KEEP,ie.w.KEEP,ie.w.KEEP,n(888)),Rt=n(576),Pt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){var e;return Object(P.a)(this,n),(e=t.apply(this,arguments)).isSchematic=!1,e.usePBR=!1,e.mrrFactors=Object(b.g)(0,1,.5),e.hasVertexColors=!1,e.hasSymbolColors=!1,e.doubleSided=!1,e.doubleSidedType="normal",e.cullFace=I.b.Back,e.emissiveFactor=Object(b.g)(0,0,0),e.instancedDoublePrecision=!1,e.normals="default",e.receiveSSAO=!0,e.receiveShadows=!0,e.castShadows=!0,e.shadowMappingEnabled=!1,e.ambient=Object(b.g)(.2,.2,.2),e.diffuse=Object(b.g)(.8,.8,.8),e.externalColor=Object(gt.c)(1,1,1,1),e.colorMixMode="multiply",e.opacity=1,e.layerOpacity=1,e.origin=Object(b.e)(),e.hasSlicePlane=!1,e.hasSliceHighlight=!0,e.offsetTransparentBackfaces=!1,e.vvSizeEnabled=!1,e.vvSizeMinSize=[1,1,1],e.vvSizeMaxSize=[100,100,100],e.vvSizeOffset=[0,0,0],e.vvSizeFactor=[1,1,1],e.vvSizeValue=[1,1,1],e.vvColorEnabled=!1,e.vvColorValues=[0,0,0,0,0,0,0,0],e.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],e.vvSymbolAnchor=[0,0,0],e.vvSymbolRotationMatrix=Object(d.b)(),e.vvOpacityEnabled=!1,e.vvOpacityValues=[],e.vvOpacityOpacities=[],e.transparent=!1,e.writeDepth=!0,e.customDepthTest=I.c.Less,e.textureAlphaMode=I.a.Blend,e.textureAlphaCutoff=xt.a,e.textureAlphaPremultiplied=!1,e.hasOccludees=!1,e.renderOccluded=Ze.c.Occlude,e}return Object(N.a)(n)}(_t.c),Nt=(_t.b,function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"initializeConfiguration",value:function(e,t){t.spherical=e.viewingMode===Ge.a.Global,t.doublePrecisionRequiresObfuscation=Object(jt.b)(e.rctx),t.textureCoordinateType=t.hasColorTexture||t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?Ot.b.Default:Ot.b.None}},{key:"initializeProgram",value:function(e){return this._initializeProgram(e,n.shader)}},{key:"_initializeProgram",value:function(e,t){var n=t.get().build(this.configuration);return new St(e.rctx,n,Me.a)}},{key:"_convertDepthTestFunction",value:function(e){return e===I.c.Lequal?ie.h.LEQUAL:ie.h.LESS}},{key:"_setPipeline",value:function(e,t){var n=this.configuration,r=e===I.h.NONE,a=e===I.h.FrontFace;return Object(Rt.e)({blending:n.output!==We.a.Color&&n.output!==We.a.Alpha||!n.transparent?null:r?Qe.c:Object(Qe.e)(e),culling:Lt(n)&&Object(Rt.b)(n.cullFace),depthTest:{func:Object(Qe.f)(e,this._convertDepthTestFunction(n.customDepthTest))},depthWrite:r||a?n.writeDepth&&Rt.d:null,colorWrite:Rt.c,stencilWrite:n.hasOccludees?wt:null,stencilTest:n.hasOccludees?t?Ct:Et:null,polygonOffset:r||a?null:Object(Qe.d)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:Object(Ue.a)(Object(Ve.a)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(yt));function Lt(e){return e.cullFace!==I.b.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}Nt.shader=new Tt(It.a,(function(){return n.e(191).then(n.bind(null,1346))}));var Dt=n(148),kt=function(){function e(){Object(P.a)(this,e),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((function(){return 0})):[],this._parameterNames||(this._parameterNames=[])}return Object(N.a)(e,[{key:"key",get:function(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}},{key:"snapshot",value:function(){var e,t=this._parameterNames,n={key:this.key},a=Object(r.a)(t);try{for(a.s();!(e=a.n()).done;){var i=e.value;n[i]=this[i]}}catch(o){a.e(o)}finally{a.f()}return n}}]),e}();function Ft(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n){var r;if(t._parameterNames=null!==(r=t._parameterNames)&&void 0!==r?r:[],t._parameterNames.push(n),null!=e.constValue)Object.defineProperty(t,n,{get:function(){return e.constValue}});else{for(var a,i=t._parameterNames.length-1,o=e.count||2,c=Math.ceil(Math.log2(o)),s=null!==(a=t._parameterBits)&&void 0!==a?a:[0],u=0;s[u]+c>16;)++u>=s.length&&s.push(0);t._parameterBits=s;var l=s[u],d=(1<<c)-1<<l;s[u]+=c,Object.defineProperty(t,n,{get:function(){return this[i]},set:function(e){if(this[i]!==e&&(this[i]=e,this._keyDirty=!0,this._parameterBits[u]=this._parameterBits[u]&~d|+e<<l&d,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+n+" must be boolean or number, got "+typeof e}})}}}var Bt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n)}(kt);Object(Dt.a)([Ft({constValue:!0})],Bt.prototype,"hasSliceHighlight",void 0),Object(Dt.a)([Ft({constValue:!1})],Bt.prototype,"hasSliceInVertexProgram",void 0),Object(Dt.a)([Ft({constValue:!1})],Bt.prototype,"instancedDoublePrecision",void 0),Object(Dt.a)([Ft({constValue:!1})],Bt.prototype,"isGround",void 0),Object(Dt.a)([Ft({constValue:At.a.Pass})],Bt.prototype,"pbrTextureBindType",void 0);var zt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){var e;return Object(P.a)(this,n),(e=t.apply(this,arguments)).output=We.a.Color,e.alphaDiscardMode=I.a.Opaque,e.doubleSidedMode=Xe.b.None,e.pbrMode=Ke.a.Disabled,e.cullFace=I.b.None,e.transparencyPassType=I.h.NONE,e.normalType=qe.b.Attribute,e.textureCoordinateType=Ot.b.None,e.customDepthTest=I.c.Less,e.spherical=!1,e.hasVertexColors=!1,e.hasSymbolColors=!1,e.hasVerticalOffset=!1,e.hasSlicePlane=!1,e.hasSliceHighlight=!0,e.hasColorTexture=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.hasScreenSizePerspective=!1,e.hasVertexTangents=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.hasModelTransformation=!1,e.offsetBackfaces=!1,e.vvSize=!1,e.vvColor=!1,e.receiveShadows=!1,e.receiveAmbientOcclusion=!1,e.textureAlphaPremultiplied=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.doublePrecisionRequiresObfuscation=!1,e.writeDepth=!0,e.transparent=!1,e.enableOffset=!0,e.cullAboveGround=!1,e.snowCover=!1,e}return Object(N.a)(n)}(Bt);Object(Dt.a)([Ft({count:We.a.COUNT})],zt.prototype,"output",void 0),Object(Dt.a)([Ft({count:I.a.COUNT})],zt.prototype,"alphaDiscardMode",void 0),Object(Dt.a)([Ft({count:Xe.b.COUNT})],zt.prototype,"doubleSidedMode",void 0),Object(Dt.a)([Ft({count:Ke.a.COUNT})],zt.prototype,"pbrMode",void 0),Object(Dt.a)([Ft({count:I.b.COUNT})],zt.prototype,"cullFace",void 0),Object(Dt.a)([Ft({count:I.h.COUNT})],zt.prototype,"transparencyPassType",void 0),Object(Dt.a)([Ft({count:qe.b.COUNT})],zt.prototype,"normalType",void 0),Object(Dt.a)([Ft({count:Ot.b.COUNT})],zt.prototype,"textureCoordinateType",void 0),Object(Dt.a)([Ft({count:I.c.COUNT})],zt.prototype,"customDepthTest",void 0),Object(Dt.a)([Ft()],zt.prototype,"spherical",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasVertexColors",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasSymbolColors",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasVerticalOffset",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasSlicePlane",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasSliceHighlight",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasColorTexture",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasEmissionTexture",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasOcclusionTexture",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasNormalTexture",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasScreenSizePerspective",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasVertexTangents",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasOccludees",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasMultipassTerrain",void 0),Object(Dt.a)([Ft()],zt.prototype,"hasModelTransformation",void 0),Object(Dt.a)([Ft()],zt.prototype,"offsetBackfaces",void 0),Object(Dt.a)([Ft()],zt.prototype,"vvSize",void 0),Object(Dt.a)([Ft()],zt.prototype,"vvColor",void 0),Object(Dt.a)([Ft()],zt.prototype,"receiveShadows",void 0),Object(Dt.a)([Ft()],zt.prototype,"receiveAmbientOcclusion",void 0),Object(Dt.a)([Ft()],zt.prototype,"textureAlphaPremultiplied",void 0),Object(Dt.a)([Ft()],zt.prototype,"instanced",void 0),Object(Dt.a)([Ft()],zt.prototype,"instancedColor",void 0),Object(Dt.a)([Ft()],zt.prototype,"instancedDoublePrecision",void 0),Object(Dt.a)([Ft()],zt.prototype,"doublePrecisionRequiresObfuscation",void 0),Object(Dt.a)([Ft()],zt.prototype,"writeDepth",void 0),Object(Dt.a)([Ft()],zt.prototype,"transparent",void 0),Object(Dt.a)([Ft()],zt.prototype,"enableOffset",void 0),Object(Dt.a)([Ft()],zt.prototype,"cullAboveGround",void 0),Object(Dt.a)([Ft()],zt.prototype,"snowCover",void 0),Object(Dt.a)([Ft({constValue:!0})],zt.prototype,"hasVvInstancing",void 0),Object(Dt.a)([Ft({constValue:!1})],zt.prototype,"useCustomDTRExponentForWater",void 0),Object(Dt.a)([Ft({constValue:!1})],zt.prototype,"supportsTextureAtlas",void 0),Object(Dt.a)([Ft({constValue:!0})],zt.prototype,"useFillLights",void 0);var Ut=n(890),Vt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"initializeConfiguration",value:function(e,t){Object(Ue.a)(Object(Ve.a)(n.prototype),"initializeConfiguration",this).call(this,e,t),t.hasMetalnessAndRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=qe.b.Attribute,t.doubleSidedMode=Xe.b.WindingOrder,t.hasVertexTangents=!1}},{key:"initializeProgram",value:function(e){return this._initializeProgram(e,n.shader)}}]),n}(Nt);Vt.shader=new Tt(Ut.a,(function(){return n.e(192).then(n.bind(null,1347))}));var Gt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(e){var r;return Object(P.a)(this,n),(r=t.call(this,e,qt)).supportsEdges=!0,r.techniqueConfig=new zt,r.vertexBufferLayout=function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=Object(He.a)().vec3f(H.a.POSITION).vec3f(H.a.NORMAL);return e.hasVertexTangents&&n.vec4f(H.a.TANGENT),t&&n.vec2f(H.a.UV0),e.hasVertexColors&&n.vec4u8(H.a.COLOR),e.hasSymbolColors&&n.vec4u8(H.a.SYMBOLCOLOR),n}(r.parameters),r.instanceBufferLayout=e.instanced?function(e){var t=Object(He.a)();return t=e.instancedDoublePrecision?t.vec3f(H.a.MODELORIGINHI).vec3f(H.a.MODELORIGINLO).mat3f(H.a.MODEL).mat3f(H.a.MODELNORMAL):t.mat4f(H.a.MODEL).mat4f(H.a.MODELNORMAL),Object(u.k)(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(H.a.INSTANCECOLOR)),Object(u.k)(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(H.a.INSTANCEFEATUREATTRIBUTE)),t}(r.parameters):null,r}return Object(N.a)(n,[{key:"isVisibleInPass",value:function(e){return e!==ke.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==ke.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==ke.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}},{key:"isVisible",value:function(){var e=this.parameters;if(!Object(Ue.a)(Object(Ve.a)(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,r=e.hasVertexColors,a=e.hasSymbolColors,i=e.vvColorEnabled,o=Object(u.k)(t)&&t.includes("color"),c="replace"===e.colorMixMode,s=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return r&&(o||i||a)?!!c||s:r?c?l:s:o||i||a?!!c||s:c?l:s}},{key:"getConfiguration",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=Object(u.k)(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=Object(u.k)(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?qe.b.ScreenDerivative:qe.b.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,Object(u.k)(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?I.b.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=Object(u.k)(this.parameters.modelTransformation),e!==We.a.Color&&e!==We.a.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Xe.b.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Xe.b.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Xe.b.WindingOrder:Xe.b.None,this.techniqueConfig.instancedColor=Object(u.k)(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ke.a.Schematic:Ke.a.Normal:Ke.a.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Qe.a,this.techniqueConfig.snowCover=this.hasSnowCover(t)),this.techniqueConfig}},{key:"hasSnowCover",value:function(e){return Object(u.k)(e.weather)&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}},{key:"intersect",value:function(e,t,n,r,a,i,o){if(Object(u.k)(this.parameters.verticalOffset)){var c=r.camera;Object(v.u)($t,n[12],n[13],n[14]);var s=null;switch(r.viewingMode){case Ge.a.Global:s=Object(v.p)(Qt,$t);break;case Ge.a.Local:s=Object(v.e)(Qt,Zt)}var l=0,d=Object(v.d)(en,$t,c.eye),f=Object(v.n)(d),h=Object(v.i)(d,d,1/f),b=null;this.parameters.screenSizePerspective&&(b=Object(v.g)(s,h)),l+=Object(mt.e)(c,f,this.parameters.verticalOffset,b,this.parameters.screenSizePerspective),Object(v.i)(s,s,l),Object(v.v)(Jt,s,r.transform.inverseRotation),a=Object(v.d)(Kt,a,Jt),i=Object(v.d)(Yt,i,Jt)}var p;Object(mt.c)(e,t,r,a,i,(p=r.verticalOffset,Object(u.k)(p)?(st.offset=p,st):null),o)}},{key:"requiresSlot",value:function(e){return e===(this.parameters.transparent?this.parameters.writeDepth?Be.TRANSPARENT_MATERIAL:Be.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Be.OPAQUE_MATERIAL)||e===Be.DRAPED_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===We.a.Color||e.output===We.a.Alpha||e.output===We.a.Depth||e.output===We.a.Normal||e.output===We.a.Shadow||e.output===We.a.Highlight?new Ht(e):null}},{key:"createBufferWriter",value:function(){return new Xt(this.vertexBufferLayout,this.instanceBufferLayout)}}]),n}(Ze.a),Ht=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(e){return Object(P.a)(this,n),t.call(this,Object(a.a)(Object(a.a)({},e),e.material.parameters))}return Object(N.a)(n,[{key:"_updateParameters",value:function(e){var t=this._material.parameters;this.updateTexture(t.textureId);var n=e.camera.viewInverseTransposeMatrix;return Object(v.u)(t.origin,n[3],n[7],n[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?Vt:Nt,e)}},{key:"_updateShadowState",value:function(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==We.a.Color&&this._output!==We.a.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this._updateParameters(e)}}]),n}(Ye.a),Wt=function(e){Object(L.a)(n,e);var t=Object(D.a)(n);function n(){var e;return Object(P.a)(this,n),(e=t.apply(this,arguments)).initTextureTransparent=!1,e.treeRendering=!1,e.hasVertexTangents=!1,e}return Object(N.a)(n)}(Pt),qt=new Wt,Xt=function(){function e(t,n){Object(P.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return Object(N.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(H.a.POSITION).length}},{key:"write",value:function(e,t,n,a){!function(e,t,n,a,i,o){var c,s=Object(r.a)(t.fieldNames);try{for(s.s();!(c=s.n()).done;){var u=c.value,l=e.vertexAttributes.get(u),d=e.indices.get(u);if(l&&d)switch(u){case H.a.POSITION:Object(F.a)(3===l.size);var f=i.getField(u,m.u);f&&ht(d,l.data,n,f,o);break;case H.a.NORMAL:Object(F.a)(3===l.size);var h=i.getField(u,m.u);h&&vt(d,l.data,a,h,o);break;case H.a.UV0:Object(F.a)(2===l.size);var v=i.getField(u,m.m);v&&lt(d,l.data,v,o);break;case H.a.COLOR:Object(F.a)(3===l.size||4===l.size);var b=i.getField(u,m.J);b&&pt(d,l.data,l.size,b,o);break;case H.a.SYMBOLCOLOR:Object(F.a)(3===l.size||4===l.size);var p=i.getField(u,m.J);p&&pt(d,l.data,l.size,p,o);break;case H.a.TANGENT:Object(F.a)(4===l.size);var g=i.getField(u,m.C);g&&bt(d,l.data,a,g,o)}}}catch(O){s.e(O)}finally{s.f()}}(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,a)}}]),e}();var Kt=Object(b.e)(),Yt=Object(b.e)(),Zt=Object(b.g)(0,0,1),Qt=Object(b.e)(),Jt=Object(b.e)(),$t=Object(b.e)(),en=Object(b.e)(),tn=S.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function nn(e,t){return rn.apply(this,arguments)}function rn(){return rn=Object(i.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,an(t,n);case 2:return r=e.sent,e.t0=r,e.next=6,hn(r.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)}))),rn.apply(this,arguments)}function an(e,t){return on.apply(this,arguments)}function on(){return(on=Object(i.a)(c.a.mark((function e(t,n){var r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=Object(u.k)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",cn(t,r,n));case 3:return e.next=5,Object(A.c)(Object(y.default)(t,Object(u.q)(n)));case 5:if(!0!==(a=e.sent).ok){e.next=8;break}return e.abrupt("return",a.value.data);case 8:Object(w.o)(a.error),un(a.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e,t,n){return sn.apply(this,arguments)}function sn(){return(sn=Object(i.a)(c.a.mark((function e(t,n,r){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(A.c)(n.request(t,"json",r));case 2:if(!0!==(a=e.sent).ok){e.next=5;break}return e.abrupt("return",a.value);case 5:Object(w.o)(a.error),un(a.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function un(e){throw new M.a("","Request for object resource failed: ".concat(e))}function ln(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(tn.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var a=t.faces;if(a){if(t.vertexAttributes)for(var i in t.vertexAttributes){var o=a[i];o&&o.values?(null!=o.valueType&&"UInt32"!==o.valueType&&(tn.warn("Unsupported indexed geometry indices type '".concat(o.valueType,"', only UInt32 is currently supported")),r=!1),null!=o.valuesPerElement&&1!==o.valuesPerElement&&(tn.warn("Unsupported indexed geometry values per element '".concat(o.valuesPerElement,"', only 1 is currently supported")),r=!1)):(tn.warn("Indexed geometry does not specify face indices for '".concat(i,"' attribute")),r=!1)}}else tn.warn("Indexed geometries must specify faces"),r=!1;break;default:tn.warn("Unsupported topology '".concat(n,"'")),r=!1}e.params.material||(tn.warn("Geometry requires material"),r=!1);var c=e.params.vertexAttributes;for(var s in c)c[s].values||(tn.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function dn(e,t){var n=[],r=[],a=[],i=[],o=e.resource,c=E.a.parse(o.version||"1.0","wosr");mn.validate(c);for(var s=o.model.name,l=o.model.geometries,d=o.materialDefinitions,f=e.textures,h=0,v=new Map,p=0;p<l.length;p++){var m=l[p];if(ln(m)){var g=pn(m),O=m.params.vertexAttributes,_=[];for(var x in O){var j=O[x],T=j.values;_.push([x,{data:T,size:j.valuesPerElement,exclusive:!0}])}var y=[];if("PerAttributeArray"!==m.params.topology){var A=m.params.faces;for(var M in A)y.push([M,new Uint32Array(A[M].values)])}var S=f&&f[g.texture];if(S&&!v.has(g.texture)){var w=S.image,C=S.params,R=new De(w,C);i.push(R),v.set(g.texture,R)}var P=v.get(g.texture),N=P?P.id:void 0,L=a[g.material]?a[g.material][g.texture]:null;if(!L){var D=d[g.material.substring(g.material.lastIndexOf("/")+1)].params;1===D.transparency&&(D.transparency=0);var k=S&&S.alphaChannelUsage,F=D.transparency>0||"transparency"===k||"maskAndTransparency"===k,B=S?bn(S.alphaChannelUsage):void 0,z={ambient:Object(b.f)(D.diffuse),diffuse:Object(b.f)(D.diffuse),opacity:1-(D.transparency||0),transparent:F,textureAlphaMode:B,textureAlphaCutoff:.33,textureId:N,initTextureTransparent:!0,doubleSided:!0,cullFace:I.b.None,colorMixMode:D.externalColorMixMode||"tint",textureAlphaPremultiplied:!!S&&!!S.params.preMultiplyAlpha};Object(u.k)(t)&&t.materialParamsMixin&&Object.assign(z,t.materialParamsMixin),L=new Gt(z),a[g.material]||(a[g.material]={}),a[g.material][g.texture]=L}r.push(L);var U=new W(_,y);h+=y.position?y.position.length:0,n.push(U)}}return{name:s,stageResources:{textures:i,materials:r,geometries:n},pivotOffset:o.model.pivotOffset,boundingBox:fn(n),numberOfVertices:h,lodThreshold:null}}function fn(e){var t=Object(p.c)();return e.forEach((function(e){var n=e.boundingInfo;Object(u.k)(n)&&(Object(p.g)(t,n.getBBMin()),Object(p.g)(t,n.getBBMax()))})),t}function hn(e,t){return vn.apply(this,arguments)}function vn(){return vn=Object(i.a)(c.a.mark((function e(t,n){var a,i,o,s,l,d,f,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],i=function(e){var r=t[e],i=r.images[0].data;if(!i)return tn.warn("Externally referenced texture data is not yet supported"),"continue";var o=r.encoding+";base64,"+i,c="/textureDefinitions/"+e,s="rgba"===r.channels?r.alphaChannelUsage||"transparency":"none",l={noUnpackFlip:!0,wrap:{s:ie.B.REPEAT,t:ie.B.REPEAT},preMultiplyAlpha:bn(s)!==I.a.Opaque},d=Object(u.k)(n)&&n.disableTextures?Promise.resolve(null):Object(C.a)(o,n);a.push(d.then((function(e){return{refId:c,image:e,params:l,alphaChannelUsage:s}})))},e.t0=c.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(o=e.t1.value,"continue"!==i(o)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(a);case 12:s=e.sent,l={},d=Object(r.a)(s);try{for(d.s();!(f=d.n()).done;)h=f.value,l[h.refId]=h}catch(v){d.e(v)}finally{d.f()}return e.abrupt("return",l);case 17:case"end":return e.stop()}}),e)}))),vn.apply(this,arguments)}function bn(e){switch(e){case"mask":return I.a.Mask;case"maskAndTransparency":return I.a.MaskBlend;case"none":return I.a.Opaque;default:return I.a.Blend}}function pn(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var mn=new E.a(1,2,"wosr"),gn=n(1056),On=n(738),_n=n(739),xn=n(573);function jn(e,t){return Tn.apply(this,arguments)}function Tn(){return(Tn=Object(i.a)(c.a.mark((function e(t,n){var r,i,o,l,d,f,h,v,b,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(r=yn(Object(s.a)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(r.url,n):nn(r.url,n);case 4:return i=e.sent,o=dn(i,n),e.abrupt("return",{lods:[o],referenceBoundingBox:o.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:i.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(r.url,n,n.usePBR):Object(j.a)(new x.a(n.streamDataRequester),r.url,n,n.usePBR);case 9:if(l=e.sent,d=Object(u.i)(l.model.meta,"ESRI_proxyEllipsoid"),l.meta.isEsriSymbolResource&&Object(u.k)(d)&&l.meta.uri.includes("/RealisticTrees/")&&Mn(l,d),f=l.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:!!l.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:n.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},h=Object(a.a)(Object(a.a)({},n.materialParamsMixin),{},{treeRendering:!!l.customMeta.esriTreeRendering}),null==r.specifiedLodIndex){e.next=18;break}return v=An(l,f,h,r.specifiedLodIndex),b=v[0].boundingBox,0!==r.specifiedLodIndex&&(b=An(l,f,h,0)[0].boundingBox),e.abrupt("return",{lods:v,referenceBoundingBox:b,isEsriSymbolResource:l.meta.isEsriSymbolResource,isWosr:!1,remove:l.remove});case 18:return p=An(l,f,h),e.abrupt("return",{lods:p,referenceBoundingBox:p[0].boundingBox,isEsriSymbolResource:l.meta.isEsriSymbolResource,isWosr:!1,remove:l.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yn(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function An(e,t,n,r){var i=e.model,o=Object(d.b)(),c=new Array,s=new Map,f=new Map;return i.lods.forEach((function(e,d){if(void 0===r||d===r){var h={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(u.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(p.c)()};c.push(h),e.parts.forEach((function(e){var r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),c=i.materials.get(e.material),d=Object(u.k)(e.attributes.texCoord0),v=Object(u.k)(e.attributes.normal),b=function(e){switch(e){case"BLEND":return I.a.Blend;case"MASK":return I.a.Mask;case"OPAQUE":case null:case void 0:return I.a.Opaque}}(c.alphaMode);if(!s.has(r)){if(d){if(Object(u.k)(c.textureColor)&&!f.has(c.textureColor)){var x=i.textures.get(c.textureColor),j=Object(a.a)(Object(a.a)({},x.parameters),{},{preMultiplyAlpha:b!==I.a.Opaque});f.set(c.textureColor,new De(x.data,j))}if(Object(u.k)(c.textureNormal)&&!f.has(c.textureNormal)){var y=i.textures.get(c.textureNormal);f.set(c.textureNormal,new De(y.data,y.parameters))}if(Object(u.k)(c.textureOcclusion)&&!f.has(c.textureOcclusion)){var A=i.textures.get(c.textureOcclusion);f.set(c.textureOcclusion,new De(A.data,A.parameters))}if(Object(u.k)(c.textureEmissive)&&!f.has(c.textureEmissive)){var M=i.textures.get(c.textureEmissive);f.set(c.textureEmissive,new De(M.data,M.parameters))}if(Object(u.k)(c.textureMetallicRoughness)&&!f.has(c.textureMetallicRoughness)){var S=i.textures.get(c.textureMetallicRoughness);f.set(c.textureMetallicRoughness,new De(S.data,S.parameters))}}var w=Math.pow(c.color[0],1/gn.a),E=Math.pow(c.color[1],1/gn.a),C=Math.pow(c.color[2],1/gn.a),R=Math.pow(c.emissiveFactor[0],1/gn.a),P=Math.pow(c.emissiveFactor[1],1/gn.a),N=Math.pow(c.emissiveFactor[2],1/gn.a),L=Object(u.k)(c.textureColor)&&d?f.get(c.textureColor):null;s.set(r,new Gt(Object(a.a)(Object(a.a)({},t),{},{transparent:b===I.a.Blend,customDepthTest:I.c.Lequal,textureAlphaMode:b,textureAlphaCutoff:c.alphaCutoff,diffuse:[w,E,C],ambient:[w,E,C],opacity:c.opacity,doubleSided:c.doubleSided,doubleSidedType:"winding-order",cullFace:c.doubleSided?I.b.None:I.b.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normals:v?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(u.k)(L)?L.id:void 0,colorMixMode:c.colorMixMode,normalTextureId:Object(u.k)(c.textureNormal)&&d?f.get(c.textureNormal).id:void 0,textureAlphaPremultiplied:Object(u.k)(L)&&!!L.params.preMultiplyAlpha,occlusionTextureId:Object(u.k)(c.textureOcclusion)&&d?f.get(c.textureOcclusion).id:void 0,emissiveTextureId:Object(u.k)(c.textureEmissive)&&d?f.get(c.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(u.k)(c.textureMetallicRoughness)&&d?f.get(c.textureMetallicRoughness).id:void 0,emissiveFactor:[R,P,N],mrrFactors:[c.metallicFactor,c.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n)))}var D=function(e,t){switch(t){case ie.r.TRIANGLES:return Object(T.c)(e);case ie.r.TRIANGLE_STRIP:return Object(T.b)(e);case ie.r.TRIANGLE_FAN:return Object(T.a)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),k=e.attributes.position.count,F=Object(_.a)(m.u,k);Object(g.e)(F,e.attributes.position,e.transform);var B=[[H.a.POSITION,{data:F.typedBuffer,size:F.elementCount,exclusive:!0}]],z=[[H.a.POSITION,D]];if(Object(u.k)(e.attributes.normal)){var U=Object(_.a)(m.u,k);Object(l.a)(o,e.transform),Object(g.a)(U,e.attributes.normal,o),B.push([H.a.NORMAL,{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),z.push([H.a.NORMAL,D])}if(Object(u.k)(e.attributes.tangent)){var V=Object(_.a)(m.C,k);Object(l.a)(o,e.transform),Object(O.d)(V,e.attributes.tangent,o),B.push([H.a.TANGENT,{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]),z.push([H.a.TANGENT,D])}if(Object(u.k)(e.attributes.texCoord0)){var G=Object(_.a)(m.m,k);Object(On.b)(G,e.attributes.texCoord0),B.push([H.a.UV0,{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),z.push([H.a.UV0,D])}if(Object(u.k)(e.attributes.color)){var q=Object(_.a)(m.J,k);if(4===e.attributes.color.elementCount)e.attributes.color instanceof m.C?Object(O.c)(q,e.attributes.color,255):e.attributes.color instanceof m.J?Object(_n.a)(q,e.attributes.color):e.attributes.color instanceof m.H&&Object(O.c)(q,e.attributes.color,1/256);else{Object(_n.b)(q,255,255,255,255);var X=new m.B(q.buffer,0,4);e.attributes.color instanceof m.u?Object(g.d)(X,e.attributes.color,255):e.attributes.color instanceof m.B?Object(xn.a)(X,e.attributes.color):e.attributes.color instanceof m.z&&Object(g.d)(X,e.attributes.color,1/256)}B.push([H.a.COLOR,{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),z.push([H.a.COLOR,D])}var K=new W(B,z);h.stageResources.geometries.push(K),h.stageResources.materials.push(s.get(r)),d&&(Object(u.k)(c.textureColor)&&h.stageResources.textures.push(f.get(c.textureColor)),Object(u.k)(c.textureNormal)&&h.stageResources.textures.push(f.get(c.textureNormal)),Object(u.k)(c.textureOcclusion)&&h.stageResources.textures.push(f.get(c.textureOcclusion)),Object(u.k)(c.textureEmissive)&&h.stageResources.textures.push(f.get(c.textureEmissive)),Object(u.k)(c.textureMetallicRoughness)&&h.stageResources.textures.push(f.get(c.textureMetallicRoughness))),h.numberOfVertices+=k;var Y=K.boundingInfo;Object(u.k)(Y)&&(Object(p.g)(h.boundingBox,Y.getBBMin()),Object(p.g)(h.boundingBox,Y.getBBMax()))}))}})),c}function Mn(e,t){for(var n=0;n<e.model.lods.length;++n){var a=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var i,o=Object(r.a)(a.parts);try{for(o.s();!(i=o.n()).done;){var c=i.value,s=c.attributes.normal;if(Object(u.j)(s))return;for(var l=c.attributes.position,d=l.count,p=Object(b.e)(),g=Object(b.e)(),O=Object(b.e)(),x=Object(_.a)(m.J,d),j=Object(_.a)(m.u,d),T=Object(f.a)(Object(h.d)(),c.transform),y=0;y<d;y++){l.getVec(y,g),s.getVec(y,p),Object(v.o)(g,g,c.transform),Object(v.d)(O,g,t.center),Object(v.b)(O,O,t.radius);var A=O[2],M=Object(v.n)(O),S=Math.min(.45+.55*M*M,1);Object(v.b)(O,O,t.radius),Object(v.o)(O,O,T),Object(v.p)(O,O),n+1!==e.model.lods.length&&e.model.lods.length>1&&Object(v.j)(O,O,p,A>-1?.2:Math.min(-4*A-3.8,1)),j.setVec(y,O),x.set(y,0,255*S),x.set(y,1,255*S),x.set(y,2,255*S),x.set(y,3,255)}c.attributes.normal=j,c.attributes.color=x}}catch(w){o.e(w)}finally{o.f()}}}},182:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(5),a=n(142),i=n(143),o=(n(147),n(185)),c=n(146),s=n(301),u=n(212),l=n(153),d=n(422),f=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(Object(a.a)(this,e),this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(l.t.Texture,this),this._descriptor=Object(r.a)({target:l.A.TEXTURE_2D,samplingMode:l.z.LINEAR,wrapMode:l.B.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},n),t.type!==u.a.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),b(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===l.A.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}return Object(i.a)(e,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}},{key:"dispose",value:function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(l.t.Texture,this))}},{key:"release",value:function(){this.dispose()}},{key:"resize",value:function(e,t){var n=this._descriptor;if(n.width!==e||n.height!==t){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");n.width=e,n.height=t,this._descriptor.target===l.A.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}},{key:"_setDataCubeMap",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=l.A.TEXTURE_CUBE_MAP_POSITIVE_X;t<=l.A.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}},{key:"setData",value:function(e){this._setData(e)}},{key:"_setData",value:function(t,n){var r,a,i=this;if(this._context&&this._context.gl){var o=this._context.gl;this._glName||(this._glName=o.createTexture()),void 0===t&&(t=null);var u=this._descriptor;null!==(r=n)&&void 0!==r||(n=u.target);var f=b(n);null===t&&(u.width=u.width||4,u.height=u.height||4,f&&(u.depth=null!==(a=u.depth)&&void 0!==a?a:1));var m=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),e._validateTexture(this._context,u),this._configurePixelStorage();var g=u.pixelFormat,O=u.internalFormat?u.internalFormat:this._deriveInternalFormat(g,u.dataType);if(v(t)){var _=t.width,x=t.height;t instanceof HTMLVideoElement&&(_=t.videoWidth,x=t.videoHeight),u.width&&u.height,f&&u.depth,u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,O,u.hasMipmap,_,x,1),this._texImage(n,0,O,_,x,1,t),Object(s.a)(o),u.hasMipmap&&this.generateMipmap(),void 0===u.width&&(u.width=_),void 0===u.height&&(u.height=x),f&&void 0===u.depth&&(u.depth=1)}else{var j=u.width,T=u.height,y=u.depth;if(null!=j&&null!=T||console.error("Width and height must be specified!"),f&&null==y&&console.error("Depth must be specified!"),u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,O,u.hasMipmap,j,T,y),o.DEPTH24_STENCIL8&&O===o.DEPTH_STENCIL&&(O=o.DEPTH24_STENCIL8),h(t)){var A=t.levels,M=p(n,j,T,y),S=Math.min(M-1,A.length-1);Object(d.a)(o)?o.texParameteri(u.target,o.TEXTURE_MAX_LEVEL,S):u.hasMipmap=u.hasMipmap&&M===A.length;var w=O;if(!function(e){return e in l.i}(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((function(e,t,r,a){var o=A[Math.min(e,A.length-1)];i._compressedTexImage(n,e,w,t,r,a,o)}),S)}else Object(c.k)(t)?(this._texImage(n,0,O,j,T,y,t),Object(s.a)(o),u.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((function(e,t,r,a){i._texImage(n,e,O,t,r,a,null),Object(s.a)(o)}))}e._applySamplingMode(o,this._descriptor),e._applyWrapMode(o,this._descriptor),e._applyAnisotropicFilteringParameters(this._context,this._descriptor),Object(s.a)(o),this._context.bindTexture(m,e.TEXTURE_UNIT_FOR_UPDATES)}}},{key:"updateData",value:function(t,n,r,a,i,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var c=this._context.gl,s=this._descriptor,u=s.pixelFormat,l=s.internalFormat,d=s.dataType,f=s.isImmutable,b=s.target;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");var p=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);(n<0||r<0||a>s.width||i>s.height||n+a>s.width||r+i>s.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),v(o)?c.texSubImage2D(b,t,n,r,u,d,o):h(o)?c.compressedTexSubImage2D(b,t,n,r,a,i,l,o.levels[t]):c.texSubImage2D(b,t,n,r,a,i,u,d,o),this._context.bindTexture(p,e.TEXTURE_UNIT_FOR_UPDATES)}},{key:"updateData3D",value:function(t,n,r,a,i,o,c,s){s||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var u=this._context.gl;if(!Object(d.a)(u))throw new Error("3D textures are not supported in WebGL1");var l=this._descriptor,f=l.pixelFormat,v=l.dataType,p=l.isImmutable,m=l.target,g=l.internalFormat;if(p&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");b(m)||console.warn("Attempting to set 3D texture data on a non-3D texture");var O=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(n<0||r<0||a<0||i>l.width||o>l.height||c>l.depth||n+i>l.width||r+o>l.height||a+c>l.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),h(s))s=s.levels[t],u.compressedTexSubImage3D(m,t,n,r,a,i,o,c,g,s);else{var _=s;u.texSubImage3D(m,t,n,r,a,i,o,c,f,v,_)}this._context.bindTexture(O,e.TEXTURE_UNIT_FOR_UPDATES)}},{key:"generateMipmap",value:function(){var t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,e._validateTexture(this._context,t)}t.samplingMode===l.z.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=l.z.LINEAR_MIPMAP_NEAREST):t.samplingMode===l.z.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=l.z.NEAREST_MIPMAP_NEAREST);var n=this._context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(n,e.TEXTURE_UNIT_FOR_UPDATES)}},{key:"setSamplingMode",value:function(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}},{key:"setWrapMode",value:function(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,e._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}},{key:"applyChanges",value:function(){var t=this._context.gl,n=this._descriptor;this._samplingModeDirty&&(e._applySamplingMode(t,n),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,n),this._wrapModeDirty=!1)}},{key:"_deriveInternalFormat",value:function(e,t){if(this._context.type===u.a.WEBGL1)return e;switch(t){case l.q.FLOAT:switch(e){case l.p.RGBA:return l.v.RGBA32F;case l.p.RGB:return l.v.RGB32F;default:throw new Error("Unable to derive format")}case l.q.UNSIGNED_BYTE:switch(e){case l.p.RGBA:return l.v.RGBA8;case l.p.RGB:return l.v.RGB8}default:return e}}},{key:"_configurePixelStorage",value:function(){var e=this._context.gl,t=this._descriptor,n=t.unpackAlignment,r=t.flipped,a=t.preMultiplyAlpha;e.pixelStorei(e.UNPACK_ALIGNMENT,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a?1:0)}},{key:"_texStorage",value:function(e,t,n,r,a,i){var o=this._context.gl;if(!Object(d.a)(o))throw new Error("Immutable textures are not supported in WebGL1");if(!function(e){return e in l.v}(t))throw new Error("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){var c=n?p(e,r,a,i):1;b(e)?o.texStorage3D(e,c,t,r,a,i):o.texStorage2D(e,c,t,r,a),this._wasImmutablyAllocated=!0}}},{key:"_texImage",value:function(e,t,n,r,a,i,o){var s=this._context.gl,l=null,d=this._context.type===u.a.WEBGL2,f=b(e),h=this._descriptor,p=h.isImmutable,m=h.pixelFormat,g=h.dataType;if(d&&(l=s),d||!v(o))if(p){if(Object(c.k)(o)){var O=o;f?l.texSubImage3D(e,t,0,0,0,r,a,i,m,g,O):s.texSubImage2D(e,t,0,0,r,a,m,g,O)}}else{var _=Object(c.q)(o);f?l.texImage3D(e,t,n,r,a,i,0,m,g,_):s.texImage2D(e,t,n,r,a,0,m,g,_)}else s.texImage2D(e,0,n,m,g,o)}},{key:"_compressedTexImage",value:function(e,t,n,r,a,i,o){var s=this._context.gl,l=null,d=b(e),f=this._descriptor.isImmutable;if(d){if(this._context.type!==u.a.WEBGL2)throw new Error("3D textures are not supported in WebGL1");l=s}f?Object(c.k)(o)&&(d?l.compressedTexSubImage3D(e,t,0,0,0,r,a,i,n,o):s.compressedTexSubImage2D(e,t,0,0,r,a,n,o)):d?l.compressedTexImage3D(e,t,n,r,a,i,0,o):s.compressedTexImage2D(e,t,n,r,a,0,o)}},{key:"_forEachMipmapLevel",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=this._descriptor,r=n.width,a=n.height,i=n.depth,o=n.hasMipmap,c=n.target,s=c===l.A.TEXTURE_3D,u=0;e(u,r,a,i),o&&(1!==r||1!==a||s&&1!==i)&&!(u>=t);++u)r=Math.max(1,r>>1),a=Math.max(1,a>>1),s&&(i=Math.max(1,i>>1))}}],[{key:"_validateTexture",value:function(e,t){(t.width<0||t.height<0||t.depth<0)&&console.error("Negative dimension parameters are not allowed!");var n=Object(d.a)(e.gl),r=Object(o.h)(t.width)&&Object(o.h)(t.height);n||!t.isImmutable&&!b(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),n||r||("number"==typeof t.wrapMode?t.wrapMode!==l.B.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):t.wrapMode.s===l.B.CLAMP_TO_EDGE&&t.wrapMode.t===l.B.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}},{key:"_applySamplingMode",value:function(e,t){var n=t.samplingMode,r=t.samplingMode;n===l.z.LINEAR_MIPMAP_NEAREST||n===l.z.LINEAR_MIPMAP_LINEAR?(n=l.z.LINEAR,t.hasMipmap||(r=l.z.LINEAR)):n!==l.z.NEAREST_MIPMAP_NEAREST&&n!==l.z.NEAREST_MIPMAP_LINEAR||(n=l.z.NEAREST,t.hasMipmap||(r=l.z.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,n),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,r)}},{key:"_applyWrapMode",value:function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}},{key:"_applyAnisotropicFilteringParameters",value:function(e,t){var n,r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,null!==(n=t.maxAnisotropy)&&void 0!==n?n:1)}}]),e}();function h(e){return Object(c.k)(e)&&"type"in e&&"compressed"===e.type}function v(e){return Object(c.k)(e)&&!h(e)&&!function(e){return Object(c.k)(e)&&"byteLength"in e}(e)}function b(e){return e===l.A.TEXTURE_3D||e===l.A.TEXTURE_2D_ARRAY}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Math.max(t,n);return e===l.A.TEXTURE_3D&&(a=Math.max(a,r)),Math.round(Math.log(a)/Math.LN2)+1}f.TEXTURE_UNIT_FOR_UPDATES=0},230:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(143),a=n(142),i=Object(r.a)((function e(){Object(a.a)(this,e)}));function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a="",i=0;i<n.length;i++)a+=e[i]+n[i];return a+=e[e.length-1]}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(o||(o={}))},299:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"}(r||(r={}))},301:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return s}));var r=n(159),a=n(147),i=n(157).a.getLogger("esri/views/webgl");var o=!!Object(a.a)("enable-feature:webgl-debug");function c(){return o}function s(){return o}function u(e){if(c()){var t=e.getError();if(t){var n=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),a=(new Error).stack;i.error(new r.a("webgl-error","WebGL error occured",{message:n,stack:a}))}}}},319:function(e,t,n){"use strict";function r(e){return e=e||globalThis.location.hostname,u.some((function(t){var n;return null!=(null===(n=e)||void 0===n?void 0:n.match(t))}))}function a(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(i)||null!=t.match(c)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(s)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var i=/^devext.arcgis.com$/,o=/^qaext.arcgis.com$/,c=/^[\w-]*\.mapsdevext.arcgis.com$/,s=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,i,o,/^jsapps.esri.com$/,c,s]},322:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(r||(r={}))},331:function(e,t,n){"use strict";function r(){return new Float32Array(3)}function a(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r}function i(){return r()}function o(){return a(1,1,1)}function c(){return a(1,0,0)}function s(){return a(0,1,0)}function u(){return a(0,0,1)}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var l=i(),d=o(),f=c(),h=s(),v=u();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:a,createView:function(e,t){return new Float32Array(e,t,3)},zeros:i,ones:o,unitX:c,unitY:s,unitZ:u,ZEROS:l,ONES:d,UNIT_X:f,UNIT_Y:h,UNIT_Z:v},Symbol.toStringTag,{value:"Module"}))},334:function(e,t,n){"use strict";function r(){return[1,0,0,0,1,0,0,0,1]}function a(e,t){return new Float64Array(e,t,9)}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,n,r,a,i,o,c,s){return[e,t,n,r,a,i,o,c,s]},createView:a},Symbol.toStringTag,{value:"Module"}))},344:function(e,t,n){"use strict";var r,a,i,o,c,s,u,l,d,f,h,v,b,p;n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return u})),n.d(t,"h",(function(){return o})),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(a||(a={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(i||(i={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(o||(o={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(c||(c={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(s||(s={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(u||(u={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(l||(l={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(d||(d={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(f||(f={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(h||(h={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(v||(v={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(b||(b={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(p||(p={}))},349:function(e,t,n){"use strict";function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function i(e,t){return new Float64Array(e,t,16)}n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return r}));var o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:function(e,t,n,r,a,i,o,c,s,u,l,d,f,h,v,b){return[e,t,n,r,a,i,o,c,s,u,l,d,f,h,v,b]},createView:i,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},362:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(7),a=n(142),i=n(143),o=n(146),c=n(322),s=function(){function e(t,n,i,s){var u,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(a.a)(this,e),this.name=t,this.type=n,this.arraySize=l,this.bind=(u={},Object(r.a)(u,c.a.Pass,null),Object(r.a)(u,c.a.Draw,null),u),Object(o.k)(i)&&Object(o.k)(s)&&(this.bind[i]=s)}return Object(i.a)(e,[{key:"equals",value:function(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}]),e}()},406:function(e,t,n){"use strict";function r(){return[0,0,0,1]}function a(e){return[e[0],e[1],e[2],e[3]]}function i(e,t){return new Float64Array(e,t,4)}n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return i}));var o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:a,fromValues:function(e,t,n,r){return[e,t,n,r]},createView:i,IDENTITY:o},Symbol.toStringTag,{value:"Module"}))},422:function(e,t,n){"use strict";function r(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}n.d(t,"a",(function(){return r}))},442:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"}(r||(r={}))},443:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"vec3",s.a.Pass,(function(t,n,a){return t.setUniform3fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},464:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(146),s=n(216),u=n(229),l=n(633),d=n(362),f=n(322),h=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"sampler2D",f.a.Pass,(function(t,n,a){return t.bindTexture(e,r(n,a))}))}return Object(r.a)(n)}(d.a);function v(e,t,n){var r=[new h(e,t)];if(n){var a=e+"Size";r.push(new l.a(a,(function(e,n){var r=t(e,n);return Object(c.k)(r)?Object(s.a)(b,r.descriptor.width,r.descriptor.height):u.a})))}return r}var b=Object(u.b)()},490:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(60),a=n(142),i=n(143),o=n(444),c=n(538),s=function(){function e(t,n){Object(a.a)(this,e),this.layout=t,this.buffer="number"==typeof n?new ArrayBuffer(n*t.stride):n;var i,o=Object(r.a)(t.fieldNames);try{for(o.s();!(i=o.n()).done;){var c=i.value,s=t.fields.get(c);this[c]=new s.constructor(this.buffer,s.offset,this.stride)}}catch(u){o.e(u)}finally{o.f()}}return Object(i.a)(e,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"getField",value:function(e,t){var n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null}},{key:"slice",value:function(t,n){return new e(this.layout,this.buffer.slice(t*this.stride,n*this.stride))}},{key:"copyFrom",value:function(e,t,n,r){var a=this.stride;if(a%4==0){var i=new Uint32Array(e.buffer,t*a,r*a/4);new Uint32Array(this.buffer,n*a,r*a/4).set(i)}else{var o=new Uint8Array(e.buffer,t*a,r*a);new Uint8Array(this.buffer,n*a,r*a).set(o)}}}]),e}(),u=function(){function e(){Object(a.a)(this,e),this.stride=0,this.fields=new Map,this.fieldNames=[]}return Object(i.a)(e,[{key:"vec2f",value:function(e,t){return this._appendField(e,o.m,t),this}},{key:"vec2f64",value:function(e,t){return this._appendField(e,o.n,t),this}},{key:"vec3f",value:function(e,t){return this._appendField(e,o.u,t),this}},{key:"vec3f64",value:function(e,t){return this._appendField(e,o.v,t),this}},{key:"vec4f",value:function(e,t){return this._appendField(e,o.C,t),this}},{key:"vec4f64",value:function(e,t){return this._appendField(e,o.D,t),this}},{key:"mat3f",value:function(e,t){return this._appendField(e,o.f,t),this}},{key:"mat3f64",value:function(e,t){return this._appendField(e,o.g,t),this}},{key:"mat4f",value:function(e,t){return this._appendField(e,o.h,t),this}},{key:"mat4f64",value:function(e,t){return this._appendField(e,o.i,t),this}},{key:"vec4u8",value:function(e,t){return this._appendField(e,o.J,t),this}},{key:"f32",value:function(e,t){return this._appendField(e,o.a,t),this}},{key:"f64",value:function(e,t){return this._appendField(e,o.b,t),this}},{key:"u8",value:function(e,t){return this._appendField(e,o.l,t),this}},{key:"u16",value:function(e,t){return this._appendField(e,o.j,t),this}},{key:"i8",value:function(e,t){return this._appendField(e,o.e,t),this}},{key:"vec2i8",value:function(e,t){return this._appendField(e,o.q,t),this}},{key:"vec2i16",value:function(e,t){return this._appendField(e,o.o,t),this}},{key:"vec2u8",value:function(e,t){return this._appendField(e,o.t,t),this}},{key:"vec4u16",value:function(e,t){return this._appendField(e,o.H,t),this}},{key:"u32",value:function(e,t){return this._appendField(e,o.k,t),this}},{key:"_appendField",value:function(e,t,n){var r=t.ElementCount*Object(c.a)(t.ElementType),a=this.stride;this.fields.set(e,{size:r,constructor:t,offset:a,optional:n}),this.stride+=r,this.fieldNames.push(e)}},{key:"alignTo",value:function(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}},{key:"hasField",value:function(e){return this.fieldNames.includes(e)}},{key:"createBuffer",value:function(e){return new s(this,e)}},{key:"createView",value:function(e){return new s(this,e)}},{key:"clone",value:function(){var t=new e;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((function(e,n){return t.fields.set(n,e)})),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}]),e}();function l(){return new u}},495:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return S}));var r,a,i,o,c,s,u,l,d,f,h=n(32),v=n(143),b=n(142),p=n(144),m=n(145),g=n(331),O=n(1093),_=n(632),x=n(443),j=n(230),T=n(1094),y=n(464),A=n(322),M=n(1092);Object(g.b)(0,.6,.2);(f=d||(d={}))[f.Disabled=0]="Disabled",f[f.Normal=1]="Normal",f[f.Schematic=2]="Schematic",f[f.Water=3]="Water",f[f.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",f[f.COUNT=5]="COUNT";M.b;function S(e,t){var n=e.fragment,f=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===d.Normal&&f&&e.include(O.a,t),t.pbrMode!==d.Schematic)if(t.pbrMode!==d.Disabled){if(t.pbrMode===d.Normal){n.code.add(Object(j.b)(r||(r=Object(h.a)(["vec3 mrr;\nvec3 emission;\nfloat occlusion;"]))));var v=t.supportsTextureAtlas,b=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add(b===A.a.Pass?Object(y.b)("texMetallicRoughness",(function(e){return e.textureMetallicRoughness}),v):Object(T.a)("texMetallicRoughness",(function(e){return e.textureMetallicRoughness}),v)),n.code.add(Object(j.b)(a||(a=Object(h.a)(["void applyMetallnessAndRoughness(TextureLookupParameter params) {\nvec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\nmrr[0] *= metallicRoughness.b;\nmrr[1] *= metallicRoughness.g;\n}"]))))),t.hasEmissionTexture&&(n.uniforms.add(b===A.a.Pass?Object(y.b)("texEmission",(function(e){return e.textureEmissive}),v):Object(T.a)("texEmission",(function(e){return e.textureEmissive}),v)),n.code.add(Object(j.b)(i||(i=Object(h.a)(["void applyEmission(TextureLookupParameter params) {\nemission *= textureLookup(texEmission, params).rgb;\n}"]))))),t.hasOcclusionTexture?(n.uniforms.add(b===A.a.Pass?Object(y.b)("texOcclusion",(function(e){return e.textureOcclusion}),v):Object(T.a)("texOcclusion",(function(e){return e.textureOcclusion}),v)),n.code.add(Object(j.b)(o||(o=Object(h.a)(["void applyOcclusion(TextureLookupParameter params) {\nocclusion *= textureLookup(texOcclusion, params).r;\n}\nfloat getBakedOcclusion() {\nreturn occlusion;\n}"]))))):n.code.add(Object(j.b)(c||(c=Object(h.a)(["float getBakedOcclusion() { return 1.0; }"])))),n.uniforms.add(b===A.a.Pass?[new x.a("emissionFactor",(function(e){return e.emissiveFactor})),new x.a("mrrFactors",(function(e){return e.mrrFactors}))]:[new _.a("emissionFactor",(function(e){return e.emissiveFactor})),new _.a("mrrFactors",(function(e){return e.mrrFactors}))]),n.code.add(Object(j.b)(s||(s=Object(h.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),f?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""))}}else n.code.add(Object(j.b)(u||(u=Object(h.a)(["float getBakedOcclusion() { return 1.0; }"]))));else n.code.add(Object(j.b)(l||(l=Object(h.a)(["vec3 mrr = vec3(0.0, 0.6, 0.2);\nvec3 emission = vec3(0.0);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))))}},496:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return o}));var r,a,i,o,c,s=n(32),u=n(451),l=n(230),d=n(299);function f(e,t){switch(t.textureCoordinateType){case o.Default:return e.attributes.add(d.a.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(Object(l.b)(r||(r=Object(s.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\n}"]))));case o.Atlas:return e.attributes.add(d.a.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(d.a.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(Object(l.b)(a||(a=Object(s.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))));case o.None:return void e.vertex.code.add(Object(l.b)(i||(i=Object(s.a)(["void forwardTextureCoordinates() {}"]))));default:Object(u.a)(t.textureCoordinateType);case o.COUNT:return}}(c=o||(o={}))[c.None=0]="None",c[c.Default=1]="Default",c[c.Atlas=2]="Atlas",c[c.COUNT=3]="COUNT"},497:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"vec4",s.a.Pass,(function(t,n,a){return t.setUniform4fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},501:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return l}));var r,a=n(32),i=n(230);function o(e){var t=Object(i.b)(r||(r=Object(a.a)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}var c,s,u,l,d,f=n(299);function h(e,t){t.normalType===l.Attribute&&(e.attributes.add(f.a.NORMAL,"vec3"),e.vertex.code.add(Object(i.b)(c||(c=Object(a.a)(["vec3 normalModel() {\nreturn normal;\n}"]))))),t.normalType===l.CompressedAttribute&&(e.include(o),e.attributes.add(f.a.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(Object(i.b)(s||(s=Object(a.a)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),t.normalType===l.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(i.b)(u||(u=Object(a.a)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}(d=l||(l={}))[d.Attribute=0]="Attribute",d[d.CompressedAttribute=1]="CompressedAttribute",d[d.Ground=2]="Ground",d[d.ScreenDerivative=3]="ScreenDerivative",d[d.COUNT=4]="COUNT"},514:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return u}));var r=n(334),a=n(406),i=n(209),o=n(428),c=n(222),s=n(394);function u(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function l(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>o.a?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function d(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],c=n[0],s=n[1],u=n[2],l=n[3];return e[0]=r*l+o*c+a*u-i*s,e[1]=a*l+o*s+i*c-r*u,e[2]=i*l+o*u+r*s-a*c,e[3]=o*l-r*c-a*s-i*u,e}function f(e,t,n,r){var a,i,c,s,u,l=t[0],d=t[1],f=t[2],h=t[3],v=n[0],b=n[1],p=n[2],m=n[3];return(i=l*v+d*b+f*p+h*m)<0&&(i=-i,v=-v,b=-b,p=-p,m=-m),1-i>o.a?(a=Math.acos(i),c=Math.sin(a),s=Math.sin((1-r)*a)/c,u=Math.sin(r*a)/c):(s=1-r,u=r),e[0]=s*l+u*v,e[1]=s*d+u*b,e[2]=s*f+u*p,e[3]=s*h+u*m,e}function h(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function v(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+o]-t[3*o+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e}function b(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),o=Math.cos(t),c=Math.sin(n),s=Math.cos(n),u=Math.sin(r),l=Math.cos(r);return e[0]=i*s*l-o*c*u,e[1]=o*c*l+i*s*u,e[2]=o*s*u-i*c*l,e[3]=o*s*l+i*c*u,e}var p=s.c,m=s.k,g=s.a,O=d,_=s.b,x=s.d,j=s.i,T=s.e,y=T,A=s.f,M=A,S=s.j,w=s.g,E=s.h;var C=Object(i.e)(),I=Object(i.g)(1,0,0),R=Object(i.g)(0,1,0);var P=Object(a.b)(),N=Object(a.b)();var L=Object(r.b)();Object.freeze(Object.defineProperty({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:u,getAxisAngle:l,multiply:d,rotateX:function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],c=Math.sin(n),s=Math.cos(n);return e[0]=r*s+o*c,e[1]=a*s+i*c,e[2]=i*s-a*c,e[3]=o*s-r*c,e},rotateY:function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],c=Math.sin(n),s=Math.cos(n);return e[0]=r*s-i*c,e[1]=a*s+o*c,e[2]=i*s+r*c,e[3]=o*s-a*c,e},rotateZ:function(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],c=Math.sin(n),s=Math.cos(n);return e[0]=r*s+a*c,e[1]=a*s-r*c,e[2]=i*s+o*c,e[3]=o*s-i*c,e},calculateW:function(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e},slerp:f,random:function(e){var t=Object(o.b)(),n=Object(o.b)(),r=Object(o.b)(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,c=o?1/o:0;return e[0]=-n*c,e[1]=-r*c,e[2]=-a*c,e[3]=i*c,e},conjugate:h,fromMat3:v,fromEuler:b,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:p,set:m,add:g,mul:O,scale:_,dot:x,lerp:j,length:T,len:y,squaredLength:A,sqrLen:M,normalize:S,exactEquals:w,equals:E,rotationTo:function(e,t,n){var r=Object(c.g)(t,n);return r<-.999999?(Object(c.h)(C,I,t),Object(c.w)(C)<1e-6&&Object(c.h)(C,R,t),Object(c.p)(C,C),u(e,C,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(c.h)(C,t,n),e[0]=C[0],e[1]=C[1],e[2]=C[2],e[3]=1+r,S(e,e))},sqlerp:function(e,t,n,r,a,i){return f(P,t,a,i),f(N,n,r,i),f(e,P,N,2*i*(1-i)),e},setAxes:function(e,t,n,r){var a=L;return a[0]=n[0],a[3]=n[1],a[6]=n[2],a[1]=r[0],a[4]=r[1],a[7]=r[2],a[2]=-t[0],a[5]=-t[1],a[8]=-t[2],S(e,v(e,a))}},Symbol.toStringTag,{value:"Module"}))},515:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u}));var r=n(142),a=n(143),i=(n(229),n(394),n(366)),o=(Object(i.b)(),function(){function e(t){Object(r.a)(this,e),this.message=t}return Object(a.a)(e,[{key:"toString",value:function(){return"AssertException: ".concat(this.message)}}]),e}());function c(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new o(t)}function s(e,t,n,r){var a,i=(n[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];i>o&&(a=i,i=o,o=a);var c=(n[1]-e[1])/t[1],s=(r[1]-e[1])/t[1];if(c>s&&(a=c,c=s,s=a),i>s||c>o)return!1;c>i&&(i=c),s<o&&(o=s);var u=(n[2]-e[2])/t[2],l=(r[2]-e[2])/t[2];return u>l&&(a=u,u=l,l=a),!(i>l||u>o)&&(l<o&&(o=l),!(o<0))}function u(e,t,n,r){e[12]=t,e[13]=n,e[14]=r}},518:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"float",s.a.Pass,(function(t,n,a){return t.setUniform1f(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},541:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return c}));n(152);var r=n(481),a=n(222),i=n(209);n(416);function o(e){return e?{origin:Object(i.c)(e.origin),direction:Object(i.c)(e.direction)}:{origin:Object(i.e)(),direction:Object(i.e)()}}function c(e,t){var n=d.get();return n.origin=e,n.direction=t,n}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return u(e.origin,e.direction,t)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();return Object(a.e)(n.origin,e),Object(a.e)(n.direction,t),n}function l(e,t,n){var r=Object(a.g)(e.direction,Object(a.d)(n,t,e.origin));return Object(a.c)(n,e.origin,Object(a.i)(n,e.direction,r)),n}var d=new r.a((function(){return{origin:null,direction:null}}))},546:function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return m})),n.d(t,"c",(function(){return O})),n.d(t,"d",(function(){return x})),n.d(t,"e",(function(){return _})),n.d(t,"f",(function(){return y})),n.d(t,"g",(function(){return I}));n(147);var r,a,i=n(157),o=n(185),c=n(146),s=n(396),u=n(222),l=n(209),d=n(394),f=n(366);(a=r||(r={}))[a.X=0]="X",a[a.Y=1]="Y",a[a.Z=2]="Z";var h=n(541),v=n(575),b=n(416),p=i.a.getLogger("esri.geometry.support.sphere");function m(){return Object(f.b)()}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();return Object(d.c)(t,e)}function O(e){return e[3]}function _(e){return e}function x(e,t,n,r){return Object(f.c)(e,t,n,r)}function j(e,t,n){if(Object(c.j)(t))return!1;var r=t.origin,a=t.direction,i=T;i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2];var o=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],s=2*(a[0]*i[0]+a[1]*i[1]+a[2]*i[2]),u=s*s-4*o*(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]-e[3]*e[3]);if(u<0)return!1;var l=Math.sqrt(u),d=(-s-l)/(2*o),f=(-s+l)/(2*o);return(d<0||f<d&&f>0)&&(d=f),!(d<0)&&(n&&(n[0]=r[0]+a[0]*d,n[1]=r[1]+a[1]*d,n[2]=r[2]+a[2]*d),!0)}var T=Object(l.e)();function y(e,t){return j(e,t,null)}function A(e,t,n){var r=b.b.get(),a=b.a.get();Object(u.h)(r,t.origin,t.direction);var i=O(e);Object(u.h)(n,r,t.origin),Object(u.i)(n,n,1/Object(u.n)(n)*i);var o=S(e,t.origin),c=Object(v.a)(t.origin,n);return Object(s.c)(a,c+o,r),Object(u.o)(n,n,a),n}function M(e,t,n){var r=Object(u.d)(b.b.get(),t,e),a=Object(u.i)(b.b.get(),r,e[3]/Object(u.n)(r));return Object(u.c)(n,a,e)}function S(e,t){var n=Object(u.d)(b.b.get(),t,e),r=Object(u.n)(n),a=O(e),i=a+Math.abs(a-r);return Object(o.a)(a/i)}var w=Object(l.e)();function E(e,t,n,a){var i=Object(u.d)(w,t,e);switch(n){case r.X:var c=Object(o.c)(i,w)[2];return Object(u.u)(a,-Math.sin(c),Math.cos(c),0);case r.Y:var s=Object(o.c)(i,w),l=s[1],d=s[2],f=Math.sin(l);return Object(u.u)(a,-f*Math.cos(d),-f*Math.sin(d),Math.cos(l));case r.Z:return Object(u.p)(a,i);default:return}}function C(e,t){var n=Object(u.d)(R,t,e);return Object(u.n)(n)-e[3]}function I(e,t){var n=Object(u.f)(e,t),r=O(e);return n<=r*r}var R=Object(l.e)(),P=m();Object.freeze(Object.defineProperty({__proto__:null,create:m,copy:g,fromCenterAndRadius:function(e,t){return Object(f.c)(e[0],e[1],e[2],t)},wrap:function(e){return e},clear:function(e){e[0]=e[1]=e[2]=e[3]=0},fromRadius:function(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e},getRadius:O,getCenter:_,fromValues:x,elevate:function(e,t,n){return e!==n&&Object(u.e)(n,e),n[3]=e[3]+t,n},setExtent:function(e,t,n){return p.error("sphere.setExtent is not yet supported"),e===n?n:g(e,n)},intersectRay:j,intersectsRay:y,intersectRayClosestSilhouette:function(e,t,n){if(j(e,t,n))return n;var r=A(e,t,b.b.get());return Object(u.c)(n,t.origin,Object(u.i)(b.b.get(),t.direction,Object(u.k)(t.origin,r)/Object(u.n)(t.direction))),n},closestPointOnSilhouette:A,closestPoint:function(e,t,n){return j(e,t,n)?n:(Object(h.a)(t,e,n),M(e,n,n))},projectPoint:M,distanceToSilhouette:function(e,t){var n=Object(u.d)(b.b.get(),t,e),r=Object(u.r)(n),a=e[3]*e[3];return Math.sqrt(Math.abs(r-a))},angleToSilhouette:S,axisAt:E,altitudeAt:C,setAltitudeAt:function(e,t,n,a){var i=C(e,t),o=E(e,t,r.Z,R),c=Object(u.i)(R,o,n-i);return Object(u.c)(a,t,c)},containsPoint:I,tmpSphere:P},Symbol.toStringTag,{value:"Module"}))},572:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return a}));var r=n(717);function a(e,t,n){if(e.count===t.count)for(var a=e.count,i=n[0],o=n[1],c=n[2],s=n[4],u=n[5],l=n[6],d=n[8],f=n[9],h=n[10],v=n[12],b=n[13],p=n[14],m=e.typedBuffer,g=e.typedBufferStride,O=t.typedBuffer,_=t.typedBufferStride,x=0;x<a;x++){var j=x*g,T=x*_,y=O[T],A=O[T+1],M=O[T+2];m[j]=i*y+s*A+d*M+v,m[j+1]=o*y+u*A+f*M+b,m[j+2]=c*y+l*A+h*M+p}else r.a.error("source and destination buffers need to have the same number of elements")}function i(e,t,n){if(e.count===t.count)for(var a=e.count,i=n[0],o=n[1],c=n[2],s=n[3],u=n[4],l=n[5],d=n[6],f=n[7],h=n[8],v=e.typedBuffer,b=e.typedBufferStride,p=t.typedBuffer,m=t.typedBufferStride,g=0;g<a;g++){var O=g*b,_=g*m,x=p[_],j=p[_+1],T=p[_+2];v[O]=i*x+s*j+d*T,v[O+1]=o*x+u*j+f*T,v[O+2]=c*x+l*j+h*T}else r.a.error("source and destination buffers need to have the same number of elements")}function o(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*i,l=s*c;a[u]=n*o[l],a[u+1]=n*o[l+1],a[u+2]=n*o[l+2]}}function c(e,t){for(var n=Math.min(e.count,t.count),r=e.typedBuffer,a=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,c=0;c<n;c++){var s=c*a,u=c*o,l=i[u],d=i[u+1],f=i[u+2],h=l*l+d*d+f*f;if(h>0){var v=1/Math.sqrt(h);r[s]=v*l,r[s+1]=v*d,r[s+2]=v*f}}}function s(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,i=e.typedBufferStride,o=t.typedBuffer,c=t.typedBufferStride,s=0;s<r;s++){var u=s*i,l=s*c;a[u]=o[l]>>n,a[u+1]=o[l+1]>>n,a[u+2]=o[l+2]>>n}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:a,transformMat3:i,scale:o,normalize:c,shiftRight:s},Symbol.toStringTag,{value:"Module"}))},573:function(e,t,n){"use strict";function r(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,c=n?n.count:t.count,s=(n&&n.dstIndex?n.dstIndex:0)*a,u=(n&&n.srcIndex?n.srcIndex:0)*o,l=0;l<c;++l)r[s]=i[u],r[s+1]=i[u+1],r[s+2]=i[u+2],s+=a,u+=o}function a(e,t,n,r,a){for(var i,o,c=e.typedBuffer,s=e.typedBufferStride,u=null!==(i=null===a||void 0===a?void 0:a.count)&&void 0!==i?i:e.count,l=(null!==(o=null===a||void 0===a?void 0:a.dstIndex)&&void 0!==o?o:0)*s,d=0;d<u;++d)c[l]=t,c[l+1]=n,c[l+2]=r,l+=s}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));Object.freeze(Object.defineProperty({__proto__:null,copy:r,fill:a},Symbol.toStringTag,{value:"Module"}))},575:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o}));var r=n(185),a=n(222),i=n(209);function o(e,t){return Object(a.g)(e,t)/Object(a.n)(e)}function c(e,t){var n=Object(a.g)(e,t)/(Object(a.n)(e)*Object(a.n)(t));return-Object(r.a)(n)}Object(i.e)(),Object(i.e)()},576:function(e,t,n){"use strict";n.d(t,"a",(function(){return G})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return T})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return s}));var r=n(5),a=n(142),i=n(143),o=n(344),c=n(153);function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.c.ADD,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:n,opAlpha:n,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function u(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.c.ADD,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:c.c.ADD,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:e,srcAlpha:t,dstRgb:n,dstAlpha:r,opRgb:a,opAlpha:i,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}var l={face:c.n.BACK,mode:c.j.CCW},d={face:c.n.FRONT,mode:c.j.CCW},f=function(e){return e===o.b.Back?l:e===o.b.Front?d:null},h={zNear:0,zFar:1},v={r:!0,g:!0,b:!0,a:!0};function b(e){return M.intern(e)}function p(e){return w.intern(e)}function m(e){return C.intern(e)}function g(e){return R.intern(e)}function O(e){return N.intern(e)}function _(e){return D.intern(e)}function x(e){return F.intern(e)}function j(e){return z.intern(e)}function T(e){return V.intern(e)}var y=function(){function e(t,n){Object(a.a)(this,e),this.makeKey=t,this.makeRef=n,this.interns=new Map}return Object(i.a)(e,[{key:"intern",value:function(e){if(!e)return null;var t=this.makeKey(e),n=this.interns;return n.has(t)||n.set(t,this.makeRef(e)),n.get(t)}}]),e}();function A(e){return"["+e.join(",")+"]"}var M=new y(S,(function(e){return Object(r.a)({__tag:"Blending"},e)}));function S(e){return e?A([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}var w=new y(E,(function(e){return Object(r.a)({__tag:"Culling"},e)}));function E(e){return e?A([e.face,e.mode]):null}var C=new y(I,(function(e){return Object(r.a)({__tag:"PolygonOffset"},e)}));function I(e){return e?A([e.factor,e.units]):null}var R=new y(P,(function(e){return Object(r.a)({__tag:"DepthTest"},e)}));function P(e){return e?A([e.func]):null}var N=new y(L,(function(e){return Object(r.a)({__tag:"StencilTest"},e)}));function L(e){return e?A([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}var D=new y(k,(function(e){return Object(r.a)({__tag:"DepthWrite"},e)}));function k(e){return e?A([e.zNear,e.zFar]):null}var F=new y(B,(function(e){return Object(r.a)({__tag:"ColorWrite"},e)}));function B(e){return e?A([e.r,e.g,e.b,e.a]):null}var z=new y(U,(function(e){return Object(r.a)({__tag:"StencilWrite"},e)}));function U(e){return e?A([e.mask]):null}var V=new y((function(e){return e?A([S(e.blending),E(e.culling),I(e.polygonOffset),P(e.depthTest),L(e.stencilTest),k(e.depthWrite),B(e.colorWrite),U(e.stencilWrite)]):null}),(function(e){return{blending:b(e.blending),culling:p(e.culling),polygonOffset:m(e.polygonOffset),depthTest:g(e.depthTest),stencilTest:O(e.stencilTest),depthWrite:_(e.depthWrite),colorWrite:x(e.colorWrite),stencilWrite:j(e.stencilWrite)}}));var G=function(){function e(t){Object(a.a)(this,e),this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}return Object(i.a)(e,[{key:"setPipeline",value:function(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}},{key:"invalidateBlending",value:function(){this._blendingInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateCulling",value:function(){this._cullingInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidatePolygonOffset",value:function(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateDepthTest",value:function(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateStencilTest",value:function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateDepthWrite",value:function(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateColorWrite",value:function(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateStencilWrite",value:function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}},{key:"_setBlending",value:function(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}},{key:"_setCulling",value:function(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}},{key:"_setPolygonOffset",value:function(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}},{key:"_setDepthTest",value:function(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}},{key:"_setStencilTest",value:function(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}},{key:"_setDepthWrite",value:function(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}},{key:"_setColorWrite",value:function(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}},{key:"_setStencilWrite",value:function(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}},{key:"_setSubState",value:function(e,t,n,r){return(n||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}]),e}()},580:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return c}));var r,a,i,o,c,s,u=n(32),l=n(451),d=n(230);function f(e,t){var n=e.fragment;switch(n.code.add(Object(d.b)(r||(r=Object(u.a)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),t.doubleSidedMode){case c.None:n.code.add(Object(d.b)(a||(a=Object(u.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))));break;case c.View:n.code.add(Object(d.b)(i||(i=Object(u.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"]))));break;case c.WindingOrder:n.code.add(Object(d.b)(o||(o=Object(u.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"]))));break;default:Object(l.a)(t.doubleSidedMode);case c.COUNT:}}(s=c||(c={}))[s.None=0]="None",s[s.View=1]="View",s[s.WindingOrder=2]="WindingOrder",s[s.COUNT=3]="COUNT"},581:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r=.1,a=.001},584:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return g}));var r=n(396),a=n(994),i=n(222),o=n(209),c=n(632),s=n(443),u=n(143),l=n(142),d=n(144),f=n(145),h=n(362),v=n(322),b=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e,r){return Object(l.a)(this,n),t.call(this,e,"mat4",v.a.Draw,(function(t,n,a){return t.setUniformMatrix4fv(e,r(n,a))}))}return Object(u.a)(n)}(h.a),p=n(635);function m(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.b):e.uniforms.add(new c.a("cameraPosition",(function(e,t){return Object(i.u)(_,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2])})))}function g(e,t){if(e.vertex.uniforms.add(new p.a("proj",(function(e,t){return t.camera.projectionMatrix}))),t.instancedDoublePrecision){var n=function(e,t){return Object(i.u)(_,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11])};e.vertex.uniforms.add(new p.a("view",(function(e,t){return Object(r.h)(O,t.camera.viewMatrix,n(0,t))})));var a=new s.a("localOrigin",n);return e.vertex.uniforms.add(a),a}e.vertex.uniforms.add(new b("view",(function(e,t){return Object(r.h)(O,t.camera.viewMatrix,e.origin)})));var o=new c.a("localOrigin",(function(e){return e.origin}));return e.vertex.uniforms.add(o),o}var O=Object(a.a)(),_=Object(o.e)()},632:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"vec3",s.a.Draw,(function(t,n,a){return t.setUniform3fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},633:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"vec2",s.a.Pass,(function(t,n,a){return t.setUniform2fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},634:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,a=n(32),i=n(230),o=n(299);function c(e){e.attributes.add(o.a.POSITION,"vec3"),e.vertex.code.add(Object(i.b)(r||(r=Object(a.a)(["vec3 positionModel() { return position; }"]))))}},635:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"mat4",s.a.Pass,(function(t,n,a){return t.setUniformMatrix4fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},636:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r,a,i,o,c,s=n(32),u=n(143),l=n(142),d=n(144),f=n(145),h=n(146),v=n(396),b=n(349),p=n(222),m=n(209),g=n(632),O=(n(443),n(230));O.a;function _(e,t){x(e,t,[new g.a("slicePlaneOrigin",(function(e,n){return A(t,e,n)})),new g.a("slicePlaneBasis1",(function(e,n){var r;return M(t,e,n,null===(r=Object(h.q)(n.slicePlane))||void 0===r?void 0:r.basis1)})),new g.a("slicePlaneBasis2",(function(e,n){var r;return M(t,e,n,null===(r=Object(h.q)(n.slicePlane))||void 0===r?void 0:r.basis2)}))])}function x(e,t,n){if(!t.hasSlicePlane){var u=Object(O.b)(r||(r=Object(s.a)(["#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)"])));return t.hasSliceInVertexProgram&&e.vertex.code.add(u),void e.fragment.code.add(u)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(n),e.fragment.uniforms.add(n);var l=Object(O.b)(a||(a=Object(s.a)(["struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }"]))),d=Object(O.b)(i||(i=Object(s.a)(["vec4 applySliceHighlight(vec4 color, vec3 pos) {\nSliceFactors factors = calculateSliceFactors(pos);\nconst float HIGHLIGHT_WIDTH = 1.0;\nconst vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\nfactors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\nfactors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\nfactors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\nfactors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\nfactors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\nif (sliceByFactors(factors)) {\nreturn color;\n}\nfloat highlightFactor = (1.0 - step(0.5, factors.front))\n* (1.0 - step(0.5, factors.side0))\n* (1.0 - step(0.5, factors.side1))\n* (1.0 - step(0.5, factors.side2))\n* (1.0 - step(0.5, factors.side3));\nreturn mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}"]))),f=t.hasSliceHighlight?Object(O.b)(o||(o=Object(s.a)(["\n        ","\n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),d):Object(O.b)(c||(c=Object(s.a)(["#define highlightSlice(_color_, _pos_) (_color_)"])));t.hasSliceInVertexProgram&&e.vertex.code.add(l),e.fragment.code.add(l),e.fragment.code.add(f)}function j(e,t,n){return e.instancedDoublePrecision?Object(p.u)(S,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function T(e,t){return Object(h.k)(e)?Object(p.d)(w,t.origin,e):t.origin}function y(e,t,n){return e.hasSliceTranslatedView?Object(h.k)(t)?Object(v.h)(C,n.camera.viewMatrix,t):n.camera.viewMatrix:null}function A(e,t,n){if(Object(h.j)(n.slicePlane))return m.b;var r=j(e,t,n),a=T(r,n.slicePlane),i=y(e,r,n);return Object(h.k)(i)?Object(p.o)(w,a,i):a}function M(e,t,n,r){if(Object(h.j)(r)||Object(h.j)(n.slicePlane))return m.b;var a=j(e,t,n),i=T(a,n.slicePlane),o=y(e,a,n);return Object(h.k)(o)?(Object(p.c)(E,r,i),Object(p.o)(w,i,o),Object(p.o)(E,E,o),Object(p.d)(E,E,w)):r}var S=Object(m.e)(),w=Object(m.e)(),E=Object(m.e)(),C=Object(b.d)()},637:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a,i,o,c=n(32),s=n(230);function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{hasModelTransformation:!1,linearDepth:!1};if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(Object(s.b)(r||(r=Object(c.a)(["vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {\nvec4 eye = view * (model * vec4(pos, 1.0));\ndepth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\nreturn proj * eye;\n}"])))):void e.vertex.code.add(Object(s.b)(a||(a=Object(c.a)(["vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {\nreturn proj * (view * (model * vec4(pos, 1.0)));\n}"]))));t.linearDepth?e.vertex.code.add(Object(s.b)(i||(i=Object(c.a)(["vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\nvec4 eye = view * vec4(pos, 1.0);\ndepth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\nreturn proj * eye;\n}"])))):e.vertex.code.add(Object(s.b)(o||(o=Object(c.a)(["vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\nreturn proj * (view * vec4(pos, 1.0));\n}"]))))}},638:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,a,i=n(32),o=n(394),c=n(366),s=n(497),u=n(230),l=n(464);function d(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add([new l.a("ssaoTex",(function(e,t){return t.ssaoHelper.colorTexture})),new s.a("viewportPixelSz",(function(e,t){return Object(o.k)(f,t.camera.fullViewport[0],t.camera.fullViewport[1],1/t.ssaoHelper.width,1/t.ssaoHelper.height)}))]),n.code.add(Object(u.b)(r||(r=Object(i.a)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nreturn texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}"]))))):n.code.add(Object(u.b)(a||(a=Object(i.a)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}var f=Object(c.b)()},641:function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r,a,i,o,c,s,u,l=n(32),d=n(443),f=n(143),h=n(142),v=n(144),b=n(145),p=n(362),m=n(322),g=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e,r,a){return Object(h.a)(this,n),t.call(this,e,"vec4",m.a.Pass,(function(t,n,a){return t.setUniform4fv(e,r(n,a))}),a)}return Object(f.a)(n)}(p.a),O=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e,r,a){return Object(h.a)(this,n),t.call(this,e,"float",m.a.Pass,(function(t,n,a){return t.setUniform1fv(e,r(n,a))}),a)}return Object(f.a)(n)}(p.a),_=n(230),x=n(887),j=n(299),T=n(334),y=n(209);n(885).b;function A(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(j.a.INSTANCEFEATUREATTRIBUTE,"vec4");var n=e.vertex;t.vvSize?(n.uniforms.add(new d.a("vvSizeMinSize",(function(e){return e.vvSizeMinSize}))),n.uniforms.add(new d.a("vvSizeMaxSize",(function(e){return e.vvSizeMaxSize}))),n.uniforms.add(new d.a("vvSizeOffset",(function(e){return e.vvSizeOffset}))),n.uniforms.add(new d.a("vvSizeFactor",(function(e){return e.vvSizeFactor}))),n.uniforms.add(new x.a("vvSymbolRotationMatrix",(function(e){return e.vvSymbolRotationMatrix}))),n.uniforms.add(new d.a("vvSymbolAnchor",(function(e){return e.vvSymbolAnchor}))),n.code.add(Object(_.b)(r||(r=Object(l.a)(["vec3 vvScale(vec4 _featureAttribute) {\nreturn clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n}\nvec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\nreturn vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n}"])))),n.code.add(Object(_.b)(a||(a=Object(l.a)(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),t.hasVvInstancing?Object(_.b)(i||(i=Object(l.a)(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):n.code.add(Object(_.b)(o||(o=Object(l.a)(["vec4 localPosition() { return vec4(position, 1.0); }\nvec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }"])))),t.vvColor?(n.constants.add("vvColorNumber","int",8),t.hasVvInstancing&&n.uniforms.add([new O("vvColorValues",(function(e){return e.vvColorValues}),8),new g("vvColorColors",(function(e){return e.vvColorColors}),8)]),n.code.add(Object(_.b)(c||(c=Object(l.a)(["\n      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {\n        float value = featureAttribute.y;\n        if (value <= values[0]) {\n          return colors[0];\n        }\n\n        for (int i = 1; i < vvColorNumber; ++i) {\n          if (values[i] >= value) {\n            float f = (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[vvColorNumber - 1];\n      }\n\n      ","\n    "])),t.hasVvInstancing?Object(_.b)(s||(s=Object(l.a)(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):n.code.add(Object(_.b)(u||(u=Object(l.a)(["vec4 vvColor() { return vec4(1.0); }"]))))}},642:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(142),n(143),n(222);var r=n(209);n(60),n(185);Object(r.e)();var a=.4;Object(r.e)()},647:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r,a=n(32),i=n(581),o=n(230);function c(e){e.fragment.code.add(Object(o.b)(r||(r=Object(a.a)(["\n    #define discardOrAdjustAlpha(color) { if (color.a < ",") { discard; } }\n  "])),o.b.float(i.b)))}var s,u,l,d=n(143),f=n(142),h=n(144),v=n(145),b=n(362),p=n(322),m=(b.a,n(518)),g=n(344);function O(e,t){_(e,t,new m.a("textureAlphaCutoff",(function(e){return e.textureAlphaCutoff})))}function _(e,t,n){var r=e.fragment;switch(t.alphaDiscardMode!==g.a.Mask&&t.alphaDiscardMode!==g.a.MaskBlend||r.uniforms.add(n),t.alphaDiscardMode){case g.a.Blend:return e.include(c);case g.a.Opaque:r.code.add(Object(o.b)(s||(s=Object(a.a)(["void discardOrAdjustAlpha(inout vec4 color) {\ncolor.a = 1.0;\n}"]))));break;case g.a.Mask:r.code.add(Object(o.b)(u||(u=Object(a.a)(["#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }"]))));break;case g.a.MaskBlend:e.fragment.code.add(Object(o.b)(l||(l=Object(a.a)(["#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }"]))))}}},658:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r,a,i,o=n(32),c=n(230);function s(e){var t=e.fragment.code;t.add(Object(c.b)(r||(r=Object(o.a)(["vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n{\nreturn ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n}"])))),t.add(Object(c.b)(a||(a=Object(o.a)(["float integratedRadiance(float cosTheta2, float roughness)\n{\nreturn (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n}"])))),t.add(Object(c.b)(i||(i=Object(o.a)(["vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n{\nfloat cosTheta2 = 1.0 - RdotNG * RdotNG;\nfloat intRadTheta = integratedRadiance(cosTheta2, roughness);\nfloat ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\nfloat sky = 2.0 - ground;\nreturn (ground * ambientGround + sky * ambientSky) * 0.5;\n}"]))))}var u,l,d,f,h,v,b,p,m,g,O,_=n(495),x=n(1053);function j(e,t){var n=e.fragment.code;e.include(x.a),t.pbrMode===_.a.Water||t.pbrMode===_.a.WaterOnIntegratedMesh?(n.add(Object(c.b)(u||(u=Object(o.a)(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),n.add(Object(c.b)(l||(l=Object(o.a)(["vec3 fresnelReflection(float angle, vec3 f0, float f90) {\nreturn f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n}"])))),n.add(Object(c.b)(d||(d=Object(o.a)(["float normalDistributionWater(float NdotH, float roughness)\n{\nfloat r2 = roughness * roughness;\nfloat NdotH2 = NdotH * NdotH;\nfloat denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\nreturn r2 / denom;\n}"])))),n.add(Object(c.b)(f||(f=Object(o.a)(["float geometricOcclusionKelemen(float LoH)\n{\nreturn 0.25 / (LoH * LoH);\n}"])))),n.add(Object(c.b)(h||(h=Object(o.a)(["vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\nvec3  F = fresnelReflection(props.VdotH, F0, F0Max);\nfloat dSun = normalDistributionWater(props.NdotH, roughness);\nfloat V = geometricOcclusionKelemen(props.LdotH);\nfloat diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\nfloat strengthSunHaze  = 1.2;\nfloat dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\nreturn ((dSun + dSunHaze) * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\nreturn (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}"]))))):t.pbrMode!==_.a.Normal&&t.pbrMode!==_.a.Schematic||(e.include(s),n.add(Object(c.b)(v||(v=Object(o.a)(["struct PBRShadingInfo\n{\nfloat NdotL;\nfloat NdotV;\nfloat NdotH;\nfloat VdotH;\nfloat LdotH;\nfloat NdotNG;\nfloat RdotNG;\nfloat NdotAmbDir;\nfloat NdotH_Horizon;\nvec3 skyRadianceToSurface;\nvec3 groundRadianceToSurface;\nvec3 skyIrradianceToSurface;\nvec3 groundIrradianceToSurface;\nfloat averageAmbientRadiance;\nfloat ssao;\nvec3 albedoLinear;\nvec3 f0;\nvec3 f90;\nvec3 diffuseColor;\nfloat metalness;\nfloat roughness;\n};"])))),n.add(Object(c.b)(b||(b=Object(o.a)(["float normalDistribution(float NdotH, float roughness)\n{\nfloat a = NdotH * roughness;\nfloat b = roughness / (1.0 - NdotH * NdotH + a * a);\nreturn b * b * INV_PI;\n}"])))),n.add(Object(c.b)(p||(p=Object(o.a)(["const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\nconst vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\nconst vec2 c2 = vec2(-1.04, 1.04);\nvec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\nreturn c2 * a004 + r.zw;\n}"])))),n.add(Object(c.b)(m||(m=Object(o.a)(["vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\nvec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\nvec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\nvec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\nvec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\nvec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\nvec3 specularComponent = specularColor * indirectSpecular;\nreturn (diffuseComponent + specularComponent);\n}"])))),n.add(Object(c.b)(g||(g=Object(o.a)(["float gamutMapChanel(float x, vec2 p){\nreturn (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n}"])))),n.add(Object(c.b)(O||(O=Object(o.a)(["vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\nvec3 outColor;\nvec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\noutColor.x = gamutMapChanel(inColor.x, p) ;\noutColor.y = gamutMapChanel(inColor.y, p) ;\noutColor.z = gamutMapChanel(inColor.z, p) ;\nreturn outColor;\n}"])))))}},717:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=n(157).a.getLogger("esri.views.3d.support.buffer.math")},724:function(e,t,n){"use strict";function r(e,t,n){for(var r=0;r<n;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function a(e,t){for(var n=e.length,r=0;r<n;++r)o[0]=e[r],t[r]=o[0];return t}function i(e,t){for(var n=e.length,r=0;r<n;++r)o[0]=e[r],o[1]=e[r]-o[0],t[r]=o[1];return t}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i}));var o=new Float32Array(2)},725:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return h}));var r=n(344),a=n(153),i=n(576),o=Object(i.f)(a.b.SRC_ALPHA,a.b.ONE,a.b.ONE_MINUS_SRC_ALPHA,a.b.ONE_MINUS_SRC_ALPHA),c=Object(i.g)(a.b.ONE,a.b.ONE),s=Object(i.g)(a.b.ZERO,a.b.ONE_MINUS_SRC_ALPHA);function u(e){return e===r.h.FrontFace?null:e===r.h.Alpha?s:c}var l=5e5,d={factor:-1,units:-2};function f(e){return e?d:null}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.h.LESS;return e===r.h.NONE||e===r.h.FrontFace?t:a.h.LEQUAL}},726:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(5),a=n(155),i=n(154),o=n.n(i),c=n(188);function s(e,t){return u.apply(this,arguments)}function u(){return u=Object(a.a)(o.a.mark((function e(t,n){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.default)(t,Object(r.a)({responseType:"image"},n));case 2:return a=e.sent,i=a.data,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}},740:function(e,t,n){"use strict";n.d(t,"a",(function(){return _})),n.d(t,"b",(function(){return j})),n.d(t,"c",(function(){return x}));var r,a,i,o,c,s=n(143),u=n(142),l=n(144),d=n(145),f=n(32),h=n(334),v=n(366),b=n(501),p=n(1048),m=n(230),g=n(1049),O=n(887);function _(e,t){t.normalType===b.b.Attribute||t.normalType===b.b.CompressedAttribute?(e.include(b.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new g.a("transformNormalGlobalFromModel",(function(e){return e.transformNormalGlobalFromModel})),new O.a("transformNormalViewFromGlobal",(function(e){return e.transformNormalViewFromGlobal}))]),e.vertex.code.add(Object(m.b)(r||(r=Object(f.a)(["void forwardNormal() {\nvNormalWorld = transformNormalGlobalFromModel * normalModel();\nvNormalView = transformNormalViewFromGlobal * vNormalWorld;\n}"]))))):t.normalType===b.b.Ground?(e.include(p.a,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(m.b)(a||(a=Object(f.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),t.spherical?Object(m.b)(i||(i=Object(f.a)(["normalize(vPositionWorldCameraRelative);"]))):Object(m.b)(o||(o=Object(f.a)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(Object(m.b)(c||(c=Object(f.a)(["void forwardNormal() {}"]))))}var x=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(u.a)(this,n),(e=t.apply(this,arguments)).transformNormalViewFromGlobal=Object(h.b)(),e}return Object(s.a)(n)}(p.c),j=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(u.a)(this,n),(e=t.apply(this,arguments)).transformNormalGlobalFromModel=Object(h.b)(),e.toMapSpace=Object(v.b)(),e}return Object(s.a)(n)}(p.b)},741:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,a,i,o=n(32),c=n(442),s=n(1048),u=n(633),l=n(230);function d(e,t){t.output===c.a.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(Object(l.b)(r||(r=Object(o.a)(["void forwardLinearDepth() { linearDepth = gl_Position.w; }"]))))):t.output===c.a.Depth||t.output===c.a.Shadow?(e.include(s.a,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new u.a("nearFar",(function(e,t){return t.camera.nearFar}))),e.vertex.code.add(Object(l.b)(a||(a=Object(o.a)(["void forwardLinearDepth() {\nlinearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n}"]))))):e.vertex.code.add(Object(l.b)(i||(i=Object(o.a)(["void forwardLinearDepth() {}"]))))}},742:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r,a=n(32),i=n(230);function o(e){e.vertex.code.add(Object(i.b)(r||(r=Object(a.a)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},743:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r,a,i,o,c,s,u=n(32),l=n(222),d=n(209),f=n(442),h=n(886),v=n(632),b=n(230),p=n(635),m=n(299),g=n(724);function O(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(m.a.MODELORIGINHI,"vec3"),e.attributes.add(m.a.MODELORIGINLO,"vec3"),e.attributes.add(m.a.MODEL,"mat3"),e.attributes.add(m.a.MODELNORMAL,"mat3"));var n=e.vertex;t.instancedDoublePrecision&&(n.include(h.a,t),n.uniforms.add(new v.a("viewOriginHi",(function(e,t){return Object(g.b)(Object(l.u)(_,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),_)}))),n.uniforms.add(new v.a("viewOriginLo",(function(e,t){return Object(g.c)(Object(l.u)(_,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),_)})))),n.code.add(Object(b.b)(r||(r=Object(u.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;")),n.code.add(Object(b.b)(a||(a=Object(u.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?Object(b.b)(i||(i=Object(u.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;")),n.code.add(Object(b.b)(o||(o=Object(u.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);")),t.output===f.a.Normal&&(n.uniforms.add(new p.a("viewNormal",(function(e,t){return t.camera.viewInverseTransposeMatrix}))),n.code.add(Object(b.b)(c||(c=Object(u.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"))),t.hasVertexTangents&&n.code.add(Object(b.b)(s||(s=Object(u.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"))}var _=Object(d.e)()},744:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a,i,o=n(32),c=n(230),s=n(299);function u(e,t){t.hasVertexColors?(e.attributes.add(s.a.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(Object(c.b)(r||(r=Object(o.a)(["void forwardVertexColor() { vColor = color; }"])))),e.vertex.code.add(Object(c.b)(a||(a=Object(o.a)(["void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }"]))))):e.vertex.code.add(Object(c.b)(i||(i=Object(o.a)(["void forwardVertexColor() {}\nvoid forwardNormalizedVertexColor() {}"]))))}},745:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(60),a=n(144),i=n(145),o=n(142),c=n(143),s=n(159),u=n(157),l=n(146),d=u.a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder"),f=function(){function e(){Object(o.a)(this,e),this.includedModules=new Map}return Object(c.a)(e,[{key:"include",value:function(e,t){if(this.includedModules.has(e)){var n=this.includedModules.get(e);if(n!==t){d.error("Trying to include shader module multiple times with different sets of options.");for(var r=new Set,a=0,i=Object.keys(n);a<i.length;a++){var o=i[a];n[o]!==e[o]&&r.add(o)}for(var c=0,s=Object.keys(e);c<s.length;c++){var u=s[c];n[u]!==e[u]&&r.add(u)}r.forEach((function(t){return console.error("  ".concat(t,": current ").concat(n[t]," new ").concat(e[t]))}))}}else this.includedModules.set(e,t),e(this.builder,t)}}]),e}(),h=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).vertex=new p,e.fragment=new p,e.attributes=new m,e.varyings=new g,e.extensions=new O,e.constants=new _,e}return Object(c.a)(n,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}},{key:"generate",value:function(e){var t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),a="vertex"===e?this.vertex:this.fragment,i=a.uniforms.generateSource(),o=a.code.generateSource(),c="vertex"===e?j:x,s=this.constants.generateSource().concat(a.constants.generateSource());return"\n".concat(t.join("\n"),"\n\n").concat(c,"\n\n").concat(s.join("\n"),"\n\n").concat(i.join("\n"),"\n\n").concat(n.join("\n"),"\n\n").concat(r.join("\n"),"\n\n").concat(o.join("\n"))}},{key:"generateBind",value:function(e,t){var n=new Map;this.vertex.uniforms.entries.forEach((function(t){var r=t.bind[e];Object(l.k)(r)&&n.set(t.name,r)})),this.fragment.uniforms.entries.forEach((function(t){var r=t.bind[e];Object(l.k)(r)&&n.set(t.name,r)}));var r=Array.from(n.values()),a=r.length;return function(e,n){for(var i=0;i<a;++i)r[i](t,e,n)}}}]),n}(f),v=function(){function e(){Object(o.a)(this,e),this._entries=new Map}return Object(c.a)(e,[{key:"add",value:function(e){if(!Array.isArray(e))return this._add(e);var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;this._add(a)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_add",value:function(e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new s.a("Duplicate uniform name ".concat(e.name," for different uniform type"));this._entries.set(e.name,e)}},{key:"generateSource",value:function(){return Array.from(this._entries.values()).map((function(e){return Object(l.k)(e.arraySize)?"uniform ".concat(e.type," ").concat(e.name,"[").concat(e.arraySize,"];"):"uniform ".concat(e.type," ").concat(e.name,";")}))}},{key:"entries",get:function(){return Array.from(this._entries.values())}}]),e}(),b=function(){function e(){Object(o.a)(this,e),this._entries=new Array}return Object(c.a)(e,[{key:"add",value:function(e){this._entries.push(e)}},{key:"generateSource",value:function(){return this._entries}}]),e}(),p=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).uniforms=new v,e.code=new b,e.constants=new _,e}return Object(c.a)(n,[{key:"builder",get:function(){return this}}]),n}(f),m=function(){function e(){Object(o.a)(this,e),this._entries=new Array}return Object(c.a)(e,[{key:"add",value:function(e,t){this._entries.push([e,t])}},{key:"generateSource",value:function(e){return"fragment"===e?[]:this._entries.map((function(e){return"attribute ".concat(e[1]," ").concat(e[0],";")}))}}]),e}(),g=function(){function e(){Object(o.a)(this,e),this._entries=new Array}return Object(c.a)(e,[{key:"add",value:function(e,t){this._entries.push([e,t])}},{key:"generateSource",value:function(){return this._entries.map((function(e){return"varying ".concat(e[1]," ").concat(e[0],";")}))}}]),e}(),O=function(){function e(){Object(o.a)(this,e),this._entries=new Set}return Object(c.a)(e,[{key:"add",value:function(e){this._entries.add(e)}},{key:"generateSource",value:function(t){var n="vertex"===t?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((function(e){return n.includes(e)})).map((function(e){return"#extension ".concat(e," : enable")}))}}]),e}();O.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],O.ALLOWLIST_VERTEX=[];var _=function(){function e(){Object(o.a)(this,e),this._entries=new Set}return Object(c.a)(e,[{key:"add",value:function(t,n,r){var a="ERROR_CONSTRUCTOR_STRING";switch(n){case"float":a=e._numberToFloatStr(r);break;case"int":a=e._numberToIntStr(r);break;case"bool":a=r.toString();break;case"vec2":a="vec2(".concat(e._numberToFloatStr(r[0]),",                            ").concat(e._numberToFloatStr(r[1]),")");break;case"vec3":a="vec3(".concat(e._numberToFloatStr(r[0]),",                            ").concat(e._numberToFloatStr(r[1]),",                            ").concat(e._numberToFloatStr(r[2]),")");break;case"vec4":a="vec4(".concat(e._numberToFloatStr(r[0]),",                            ").concat(e._numberToFloatStr(r[1]),",                            ").concat(e._numberToFloatStr(r[2]),",                            ").concat(e._numberToFloatStr(r[3]),")");break;case"ivec2":a="ivec2(".concat(e._numberToIntStr(r[0]),",                             ").concat(e._numberToIntStr(r[1]),")");break;case"ivec3":a="ivec3(".concat(e._numberToIntStr(r[0]),",                             ").concat(e._numberToIntStr(r[1]),",                             ").concat(e._numberToIntStr(r[2]),")");break;case"ivec4":a="ivec4(".concat(e._numberToIntStr(r[0]),",                             ").concat(e._numberToIntStr(r[1]),",                             ").concat(e._numberToIntStr(r[2]),",                             ").concat(e._numberToIntStr(r[3]),")");break;case"mat2":case"mat3":case"mat4":a="".concat(n,"(").concat(Array.prototype.map.call(r,(function(t){return e._numberToFloatStr(t)})).join(", "),")")}return this._entries.add("const ".concat(n," ").concat(t," = ").concat(a,";")),this}},{key:"generateSource",value:function(){return Array.from(this._entries)}}],[{key:"_numberToIntStr",value:function(e){return e.toFixed(0)}},{key:"_numberToFloatStr",value:function(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}}]),e}(),x="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",j="precision highp float;\nprecision highp sampler2D;"},749:function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var r,a,i,o,c=n(32),s=n(222),u=n(209),l=n(394),d=n(366),f=n(495),h=n(443),v=n(497),b=n(230);function p(e,t){var n=e.fragment,u=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===u?(n.uniforms.add(new h.a("lightingAmbientSH0",(function(e,t){return Object(s.u)(g,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])}))),n.code.add(Object(b.b)(r||(r=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):1===u?(n.uniforms.add([new v.a("lightingAmbientSH_R",(function(e,t){return Object(l.k)(O,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3])})),new v.a("lightingAmbientSH_G",(function(e,t){return Object(l.k)(O,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3])})),new v.a("lightingAmbientSH_B",(function(e,t){return Object(l.k)(O,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3])}))]),n.code.add(Object(b.b)(a||(a=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):2===u&&(n.uniforms.add([new h.a("lightingAmbientSH0",(function(e,t){return Object(s.u)(g,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])})),new v.a("lightingAmbientSH_R1",(function(e,t){return Object(l.k)(O,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4])})),new v.a("lightingAmbientSH_G1",(function(e,t){return Object(l.k)(O,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4])})),new v.a("lightingAmbientSH_B1",(function(e,t){return Object(l.k)(O,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4])})),new v.a("lightingAmbientSH_R2",(function(e,t){return Object(l.k)(O,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8])})),new v.a("lightingAmbientSH_G2",(function(e,t){return Object(l.k)(O,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8])})),new v.a("lightingAmbientSH_B2",(function(e,t){return Object(l.k)(O,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8])}))]),n.code.add(Object(b.b)(i||(i=Object(c.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"])))),t.pbrMode!==f.a.Normal&&t.pbrMode!==f.a.Schematic||n.code.add(Object(b.b)(o||(o=Object(c.a)(["const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}"])))))}var m,g=Object(u.e)(),O=Object(d.b)(),_=n(638),x=n(518);function j(e,t){var n=e.fragment;t.isGround?n.uniforms.add(new x.a("lightingFixedFactor",(function(e,t){return(1-t.lighting.groundLightingFactor)*(1-t.lighting.globalFactor)}))):n.constants.add("lightingFixedFactor","float",0),n.uniforms.add([new h.a("lightingMainDirection",(function(e,t){return t.lighting.lightingMainDirection})),new h.a("lightingMainIntensity",(function(e,t){return t.lighting.mainLight.intensity}))]),n.code.add(Object(b.b)(m||(m=Object(c.a)(["vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\nfloat dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);\ndotVal = mix(dotVal, 1.0, lightingFixedFactor);\nreturn lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n}"]))))}var T,y,A,M,S,w,E,C,I,R,P,N,L,D=n(658),k=n(1053),F=n(143),B=n(142),z=n(144),U=n(145),V=n(362),G=n(322),H=function(e){Object(z.a)(n,e);var t=Object(U.a)(n);function n(e,r){return Object(B.a)(this,n),t.call(this,e,"bool",G.a.Pass,(function(t,n,a){return t.setUniform1b(e,r(n,a))}))}return Object(F.a)(n)}(V.a),W=n(642);function q(e,t){var n=e.fragment;e.include(_.a,t),t.pbrMode!==f.a.Disabled&&e.include(D.a,t),e.include(p,t),n.constants.add("ambientBoostFactor","float",W.a),e.include(k.a),n.code.add(Object(b.b)(T||(T=Object(c.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),t.pbrMode===f.a.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),n.uniforms.add(new h.a("lightingMainDirection",(function(e,t){return t.lighting.lightingMainDirection}))),n.code.add(Object(b.b)(y||(y=Object(c.a)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),t.spherical?Object(b.b)(A||(A=Object(c.a)(["normalize(vPosWorld)"]))):Object(b.b)(M||(M=Object(c.a)(["vec3(0.0, 0.0, 1.0)"]))))),n.uniforms.add([new x.a("lightingGlobalFactor",(function(e,t){return t.lighting.globalFactor})),new h.a("lightingMainIntensity",(function(e,t){return t.lighting.mainLight.intensity}))]),n.code.add(Object(b.b)(S||(S=Object(c.a)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),t.pbrMode===f.a.Disabled||t.pbrMode===f.a.WaterOnIntegratedMesh?(e.include(j,t),n.code.add(Object(b.b)(w||(w=Object(c.a)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"]))))):t.pbrMode!==f.a.Normal&&t.pbrMode!==f.a.Schematic||(n.code.add(Object(b.b)(E||(E=Object(c.a)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),n.code.add(Object(b.b)(C||(C=Object(c.a)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),t.useFillLights?n.uniforms.add(new H("hasFillLights",(function(e,t){return t.enableFillLights}))):n.constants.add("hasFillLights","bool",!1),n.code.add(Object(b.b)(I||(I=Object(c.a)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),n.uniforms.add([new x.a("lightingSpecularStrength",(function(e,t){return t.lighting.mainLight.specularStrength})),new x.a("lightingEnvironmentStrength",(function(e,t){return t.lighting.mainLight.environmentStrength}))]),n.code.add(Object(b.b)(R||(R=Object(c.a)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),n.code.add(Object(b.b)(P||(P=Object(c.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),t.pbrMode===f.a.Schematic?Object(b.b)(N||(N=Object(c.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):Object(b.b)(L||(L=Object(c.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},750:function(e,t,n){"use strict";n.d(t,"a",(function(){return V}));var r,a,i=n(32),o=n(442),c=n(636),s=n(637),u=n(501),l=n(496),d=n(740),f=n(889),h=n(230);function v(e,t){e.fragment.include(f.a),t.output===o.a.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(h.b)(r||(r=Object(i.a)(["float _calculateFragDepth(const in float depth) {\nconst float SLOPE_SCALE = 2.0;\nconst float BIAS = 2.0 * .000015259;\nfloat m = max(abs(dFdx(depth)), abs(dFdy(depth)));\nfloat result = depth + SLOPE_SCALE * m + BIAS;\nreturn clamp(result, .0, .999999);\n}\nvoid outputDepth(float _linearDepth) {\ngl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));\n}"]))))):t.output===o.a.Depth&&e.fragment.code.add(Object(h.b)(a||(a=Object(i.a)(["void outputDepth(float _linearDepth) {\ngl_FragColor = float2rgba(_linearDepth);\n}"]))))}var b,p=n(143),m=n(142),g=n(144),O=n(145),_=n(229),x=n(366),j=n(633),T=n(464),y=Object(x.c)(1,1,0,1),A=Object(x.c)(1,0,1,1);function M(e){e.fragment.uniforms.add(new T.a("depthTex",(function(e,t){return t.highlightDepthTexture}))),e.fragment.uniforms.add(new j.a("highlightViewportPixelSz",(function(e,t){return t.inverseViewport}))),e.fragment.constants.add("occludedHighlightFlag","vec4",y).add("unoccludedHighlightFlag","vec4",A),e.fragment.code.add(Object(h.b)(b||(b=Object(i.a)(["void outputHighlight() {\nvec4 fragCoord = gl_FragCoord;\nfloat sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;\nif (fragCoord.z > sceneDepth + 5e-7) {\ngl_FragColor = occludedHighlightFlag;\n}\nelse {\ngl_FragColor = unoccludedHighlightFlag;\n}\n}"]))))}h.a;var S,w,E,C,I,R,P,N,L,D,k,F,B=n(641),z=n(647),U=n(584);function V(e,t){var n=e.vertex.code,r=e.fragment.code,a=t.hasModelTransformation;t.output!==o.a.Depth&&t.output!==o.a.Shadow||(Object(U.b)(e,t),e.include(s.a,{linearDepth:!0,hasModelTransformation:a}),e.include(l.a,t),e.include(B.a,t),e.include(v,t),e.include(c.a,t),e.vertex.uniforms.add(new j.a("nearFar",(function(e,t){return t.camera.nearFar}))),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new T.a("tex",(function(e){return e.texture}))),n.add(Object(h.b)(S||(S=Object(i.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, "," vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])),a?"model,":"")),e.include(z.a,t),r.add(Object(h.b)(w||(w=Object(i.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?Object(h.b)(E||(E=Object(i.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),t.output===o.a.Normal&&(Object(U.b)(e,t),e.include(s.a,{linearDepth:!1,hasModelTransformation:a}),e.include(u.a,t),e.include(d.a,t),e.include(l.a,t),e.include(B.a,t),t.hasColorTexture&&e.fragment.uniforms.add(new T.a("tex",(function(e){return e.texture}))),e.varyings.add("vPositionView","vec3"),n.add(Object(h.b)(C||(C=Object(i.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, "," vpos);\n        forwardTextureCoordinates();\n      }\n    "])),t.normalType===u.b.Attribute?Object(h.b)(I||(I=Object(i.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"",a?"model,":"")),e.include(c.a,t),e.include(z.a,t),r.add(Object(h.b)(R||(R=Object(i.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?Object(h.b)(P||(P=Object(i.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",t.normalType===u.b.ScreenDerivative?Object(h.b)(N||(N=Object(i.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):Object(h.b)(L||(L=Object(i.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),t.output===o.a.Highlight&&(Object(U.b)(e,t),e.include(s.a,{linearDepth:!1,hasModelTransformation:a}),e.include(l.a,t),e.include(B.a,t),t.hasColorTexture&&e.fragment.uniforms.add(new T.a("tex",(function(e){return e.texture}))),n.add(Object(h.b)(D||(D=Object(i.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, "," vpos);\n        forwardTextureCoordinates();\n      }\n    "])),a?"model,":"")),e.include(c.a,t),e.include(z.a,t),e.include(M),r.add(Object(h.b)(k||(k=Object(i.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?Object(h.b)(F||(F=Object(i.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},761:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r,a=n(32),i=n(1050),o=n(230);function c(e){e.vertex.code.add(Object(o.b)(r||(r=Object(a.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),o.b.int(i.a.Multiply),o.b.int(i.a.Replace),o.b.int(i.a.Tint),o.b.int(i.a.Multiply)))}var s,u,l=n(1051),d=n(299),f=n(901);function h(e,t){t.hasSymbolColors?(e.include(c),e.attributes.add(d.a.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(Object(o.b)(s||(s=Object(a.a)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"]))))):(e.fragment.uniforms.add(new l.a("colorMixMode",(function(e){return f.a[e.colorMixMode]}))),e.vertex.code.add(Object(o.b)(u||(u=Object(a.a)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"])))))}},762:function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r,a,i,o,c,s,u,l=n(32),d=n(394),f=n(366),h=n(497),v=n(230);function b(e){e.vertex.code.add(Object(v.b)(r||(r=Object(l.a)(["float screenSizePerspectiveMinSize(float size, vec4 factor) {\nfloat nonZeroSize = 1.0 - step(size, 0.0);\nreturn (\nfactor.z * (\n1.0 +\nnonZeroSize *\n2.0 * factor.w / (\nsize + (1.0 - nonZeroSize)\n)\n)\n);\n}"])))),e.vertex.code.add(Object(v.b)(a||(a=Object(l.a)(["float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\nreturn absCosAngle * absCosAngle * absCosAngle;\n}"])))),e.vertex.code.add(Object(v.b)(i||(i=Object(l.a)(["vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\nreturn vec4(\nmin(params.x / (distanceToCamera - params.y), 1.0),\nscreenSizePerspectiveViewAngleDependentFactor(absCosAngle),\nparams.z,\nparams.w\n);\n}"])))),e.vertex.code.add(Object(v.b)(o||(o=Object(l.a)(["float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\nreturn max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}"])))),e.vertex.code.add(Object(v.b)(c||(c=Object(l.a)(["float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorFloat(\nsize,\nscreenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n);\n}"])))),e.vertex.code.add(Object(v.b)(s||(s=Object(l.a)(["vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\nreturn mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);\n}"])))),e.vertex.code.add(Object(v.b)(u||(u=Object(l.a)(["vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}"]))))}function p(e){return Object(d.k)(T,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}var m,g,O,_,x,j,T=Object(f.b)(),y=n(584);function A(e,t){var n=e.vertex;t.hasVerticalOffset?(function(e){e.uniforms.add(new h.a("verticalOffset",(function(e,t){var n=e.verticalOffset,r=n.minWorldLength,a=n.maxWorldLength,i=n.screenLength,o=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),c=t.camera.pixelRatio||1;return Object(d.k)(M,i*c,o,r,a)})))}(n),t.hasScreenSizePerspective&&(e.include(b),function(e){e.uniforms.add(new h.a("screenSizePerspectiveAlignment",(function(e){return p(e.screenSizePerspectiveAlignment||e.screenSizePerspective)})))}(n),Object(y.a)(e.vertex,t)),n.code.add(Object(v.b)(m||(m=Object(l.a)(["\n      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n        ","\n        ","\n        // Screen sized offset in world space, used for example for line callouts\n        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n        return worldNormal * worldOffset;\n      }\n\n      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n      }\n    "])),t.spherical?Object(v.b)(g||(g=Object(l.a)(["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):Object(v.b)(O||(O=Object(l.a)(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),t.hasScreenSizePerspective?Object(v.b)(_||(_=Object(l.a)(["\n            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));\n            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):Object(v.b)(x||(x=Object(l.a)(["\n            float verticalOffsetScreenHeight = verticalOffset.x;"])))))):n.code.add(Object(v.b)(j||(j=Object(l.a)(["vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }"]))))}var M=Object(f.b)()},763:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));n(143),n(142);var r,a=n(32),i=n(889),o=n(230);function c(e){e.include(i.a),e.code.add(Object(o.b)(r||(r=Object(a.a)(["float linearDepthFromFloat(float depth, vec2 nearFar) {\nreturn -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\nfloat linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {\nreturn linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);\n}"]))))}var s,u=n(633),l=n(464);function d(e,t){t.hasMultipassTerrain&&(e.fragment.include(c),e.fragment.uniforms.add(new l.a("terrainDepthTexture",(function(e,t){return t.multipassTerrain.linearDepthTexture}))),e.fragment.uniforms.add(new u.a("nearFar",(function(e,t){return t.camera.nearFar}))),e.fragment.uniforms.add(new u.a("inverseViewport",(function(e,t){return t.inverseViewport}))),e.fragment.code.add(Object(o.b)(s||(s=Object(a.a)(["\n    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){\n      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);\n      if(fragmentDepth "," terrainDepth){\n        discard;\n      }\n    }\n  "])),t.cullAboveGround?">":"<=")))}},764:function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return _}));var r,a=n(32),i=n(143),o=n(142),c=n(144),s=n(145),u=n(209),l=n(889),d=n(497),f=n(518),h=n(1051),v=n(230),b=n(411),p=n(362),m=n(322),g=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(e,r,a,i){var c;switch(Object(o.a)(this,n),r){case m.a.Pass:return Object(b.a)(c,void(c=t.call(this,e,"mat4",r,(function(t,n,r){return t.setUniformMatrix4fv(e,a(n,r))}),i)));case m.a.Draw:return Object(b.a)(c,void(c=t.call(this,e,"mat4",r,(function(t,n,r){return t.setUniformMatrix4fv(e,a(n,r))}),i)))}return c}return Object(i.a)(n)}(p.a),O=n(464);v.a;function _(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new g("shadowMapMatrix",m.a.Pass,(function(e,t){return t.shadowMap.getShadowMapMatrices(e.origin)}),4)),j(e))}function x(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new g("shadowMapMatrix",m.a.Draw,(function(e,t){return t.shadowMap.getShadowMapMatrices(e.origin)}),4)),j(e))}function j(e){var t=e.fragment;t.include(l.a),t.uniforms.add([new O.a("shadowMapTex",(function(e,t){return t.shadowMap.depthTexture})),new h.a("numCascades",(function(e,t){return t.shadowMap.numCascades})),new d.a("cascadeDistances",(function(e,t){return t.shadowMap.cascadeDistances})),new f.a("depthHalfPixelSz",(function(e,t){return.5/t.shadowMap.textureSize}))]),t.code.add(Object(v.b)(r||(r=Object(a.a)(["int chooseCascade(float depth, out mat4 mat) {\nvec4 distance = cascadeDistances;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= numCascades) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);\n}"]))))}},765:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a,i=n(32),o=n(1050),c=n(230);function s(e){e.code.add(Object(c.b)(r||(r=Object(i.a)(["vec4 premultiplyAlpha(vec4 v) {\nreturn vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nfloat rgb2v(vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}"]))))}function u(e){e.include(s),e.code.add(Object(c.b)(a||(a=Object(i.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      if (mode == ",") {\n        return internalMixed;\n      }\n      if (mode == ",") {\n        return externalColor;\n      }\n\n      // tint (or something invalid)\n      float vIn = rgb2v(internalMixed);\n      vec3 hsvTint = rgb2hsv(externalColor);\n      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n      return hsv2rgb(hsvOut);\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      if (mode == ",") {\n        return externalOpacity;\n      }\n\n      // multiply or tint (or something invalid)\n      return allMixed;\n    }\n  "])),c.b.int(o.a.Multiply),c.b.int(o.a.Ignore),c.b.int(o.a.Replace),c.b.int(o.a.Ignore),c.b.int(o.a.Replace)))}},882:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(142),a=n(143),i=n(591),o=function(){function e(){Object(r.a)(this,e),this.id=Object(i.a)()}return Object(a.a)(e,[{key:"unload",value:function(){}}]),e}()},883:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"}(r||(r={}))},884:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(299),a=new Map([[r.a.POSITION,0],[r.a.NORMAL,1],[r.a.UV0,2],[r.a.COLOR,3],[r.a.SIZE,4],[r.a.TANGENT,4],[r.a.AUXPOS1,5],[r.a.SYMBOLCOLOR,5],[r.a.AUXPOS2,6],[r.a.FEATUREATTRIBUTE,6],[r.a.INSTANCEFEATUREATTRIBUTE,6],[r.a.INSTANCECOLOR,7],[r.a.MODEL,8],[r.a.MODELNORMAL,12],[r.a.MODELORIGINHI,11],[r.a.MODELORIGINLO,15]])},885:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return r}));var r,a,i=n(142),o=n(143),c=n(144),s=n(145),u=n(146),l=n(230),d=n(882),f=n(883),h=n(884),v=n(901),b=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).type=f.a.Material,a.supportsEdges=!1,a._visible=!0,a._renderPriority=0,a._insertOrder=0,a._vertexAttributeLocations=h.a,a._parameters=Object(v.b)(e,r),a.validateParameters(a._parameters),a}return Object(o.a)(n,[{key:"dispose",value:function(){}},{key:"parameters",get:function(){return this._parameters}},{key:"update",value:function(e){return!1}},{key:"setParameters",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(v.d)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this.parametersChanged())}},{key:"validateParameters",value:function(e){}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}},{key:"shouldRender",value:function(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}},{key:"isVisibleInPass",value:function(e){return!0}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}},{key:"isVisible",value:function(){return this._visible}},{key:"parametersChanged",value:function(){Object(u.k)(this.repository)&&this.repository.materialChanged(this)}}]),n}(d.a);(a=r||(r={}))[a.Occlude=1]="Occlude",a[a.Transparent=2]="Transparent",a[a.OccludeAndTransparent=4]="OccludeAndTransparent",a[a.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",a[a.Opaque=16]="Opaque";var p=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments)).renderOccluded=r.Occlude,e}return Object(o.a)(n)}(l.a)},886:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var r,a,i=n(32),o=n(147),c=n(230);function s(e,t){var n=e.code;t.doublePrecisionRequiresObfuscation?n.add(Object(c.b)(r||(r=Object(i.a)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):n.add(Object(c.b)(a||(a=Object(i.a)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function u(e){return!!Object(o.a)("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},887:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(143),a=n(142),i=n(144),o=n(145),c=n(362),s=n(322),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e,r){return Object(a.a)(this,n),t.call(this,e,"mat3",s.a.Pass,(function(t,n,a){return t.setUniformMatrix3fv(e,r(n,a))}))}return Object(r.a)(n)}(c.a)},888:function(e,t,n){"use strict";n.d(t,"a",(function(){return ve})),n.d(t,"b",(function(){return he}));var r,a,i,o,c,s,u,l,d,f,h,v,b,p,m,g,O,_,x,j,T,y,A,M=n(32),S=n(146),w=n(349),E=n(741),C=n(742),I=n(442),R=n(636),P=n(637),N=n(743),L=n(501),D=n(634),k=n(761),F=n(496),B=n(744),z=n(740),U=n(762),V=n(750),G=n(1052),H=n(638),W=n(749),q=n(763),X=n(580),K=n(658),Y=n(495),Z=n(764),Q=n(641),J=n(581),$=n(647),ee=n(1054),te=n(765),ne=n(584),re=n(443),ae=n(497),ie=n(518),oe=n(230),ce=n(635),se=n(745),ue=n(464),le=n(344),de=n(299),fe=n(642);function he(e){var t=new se.a,n=t.vertex.code,he=t.fragment.code;t.include(ee.a,{name:"Default Material Shader",output:e.output});var ve=Object(ne.b)(t,e);return t.include(D.a),t.varyings.add("vpos","vec3"),t.include(Q.a,e),t.include(N.a,e),t.include(U.a,e),e.output!==I.a.Color&&e.output!==I.a.Alpha||(Object(ne.a)(t.vertex,e),t.include(L.a,e),t.include(P.a,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===L.b.Attribute&&e.offsetBackfaces&&t.include(C.a),t.include(G.a,e),t.include(z.a,e),e.instancedColor&&t.attributes.add(de.a.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(F.a,e),t.include(E.a,e),t.include(k.a,e),t.include(B.a,e),t.vertex.uniforms.add(new ae.a("externalColor",(function(e){return e.externalColor}))),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new ce.a("model",(function(e){return Object(S.k)(e.modelTransformation)?e.modelTransformation:w.a}))),n.add(Object(oe.b)(r||(r=Object(M.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        } else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, "," vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",oe.b.float(J.b),e.normalType===L.b.Attribute?Object(oe.b)(a||(a=Object(M.a)(["vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",e.hasModelTransformation?"model,":"",e.normalType===L.b.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":"",e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""))),e.output===I.a.Alpha&&(t.include(R.a,e),t.include($.a,e),t.include(q.a,e),t.fragment.uniforms.add([new ie.a("opacity",(function(e){return e.opacity})),new ie.a("layerOpacity",(function(e){return e.layerOpacity}))]),e.hasColorTexture&&t.fragment.uniforms.add(new ue.a("tex",(function(e){return e.texture}))),t.fragment.include(te.a),he.add(Object(oe.b)(i||(i=Object(M.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(oe.b)(o||(o=Object(M.a)(["\n                vec4 texColor = texture2D(tex, vuv0);\n                ","\n                discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(oe.b)(c||(c=Object(M.a)(["vec4 texColor = vec4(1.0);"]))),e.hasVertexColors?Object(oe.b)(s||(s=Object(M.a)(["float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(oe.b)(u||(u=Object(M.a)(["float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));"])))))),e.output===I.a.Color&&(t.include(R.a,e),t.include(W.a,e),t.include(H.a,e),t.include($.a,e),t.include(e.instancedDoublePrecision?Z.b:Z.a,e),t.include(q.a,e),Object(ne.a)(t.fragment,e),t.fragment.uniforms.add([ve,new re.a("ambient",(function(e){return e.ambient})),new re.a("diffuse",(function(e){return e.diffuse})),new ie.a("opacity",(function(e){return e.opacity})),new ie.a("layerOpacity",(function(e){return e.layerOpacity})),new ie.a("lightingGlobalFactor",(function(e,t){return t.lighting.globalFactor})),new re.a("lightingMainIntensity",(function(e,t){return t.lighting.mainLight.intensity}))]),t.fragment.constants.add("ambientBoostFactor","float",fe.a),e.hasColorTexture&&t.fragment.uniforms.add(new ue.a("tex",(function(e){return e.texture}))),t.include(Y.b,e),t.include(K.a,e),t.fragment.include(te.a),t.include(X.a,e),he.add(Object(oe.b)(l||(l=Object(M.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - cameraPosition);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        vec3 normalGround = ","\n\n        ","\n\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(oe.b)(d||(d=Object(M.a)(["\n                vec4 texColor = texture2D(tex, vuv0);\n                ","\n                discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(oe.b)(f||(f=Object(M.a)(["vec4 texColor = vec4(1.0);"]))),e.normalType===L.b.ScreenDerivative?Object(oe.b)(h||(h=Object(M.a)(["\n                vec3 normal = screenDerivativeNormal(localvpos);"]))):Object(oe.b)(v||(v=Object(M.a)(["\n                shadingParams.normalView = vNormalWorld;\n                vec3 normal = shadingNormal(shadingParams);"]))),e.pbrMode===Y.a.Normal?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.hasVertexColors?Object(oe.b)(b||(b=Object(M.a)(["\n                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(oe.b)(p||(p=Object(M.a)(["\n                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))),e.hasNormalTexture?Object(oe.b)(m||(m=Object(M.a)(["\n                mat3 tangentSpace = ","\n                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):Object(oe.b)(g||(g=Object(M.a)(["vec3 shadingNormal = normal;"]))),e.spherical?Object(oe.b)(O||(O=Object(M.a)(["normalize(vpos + localOrigin);"]))):Object(oe.b)(_||(_=Object(M.a)(["vec3(0.0, 0.0, 1.0);"]))),e.snowCover?Object(oe.b)(x||(x=Object(M.a)(["\n                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));\n                albedo = mix(albedo, vec3(1), snow);\n                shadingNormal = mix(shadingNormal, normal, snow);\n                ssao = mix(ssao, 1.0, snow);"]))):"",e.pbrMode===Y.a.Normal||e.pbrMode===Y.a.Schematic?Object(oe.b)(j||(j=Object(M.a)(["\n                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n                ","\n\n                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"])),e.snowCover?Object(oe.b)(T||(T=Object(M.a)(["\n                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);\n                        emission = mix(emission, vec3(0.0), snow);"]))):""):Object(oe.b)(y||(y=Object(M.a)(["vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);"]))),e.transparencyPassType===le.h.Color?Object(oe.b)(A||(A=Object(M.a)(["gl_FragColor = premultiplyAlpha(gl_FragColor);"]))):""))),t.include(V.a,e),t}var ve=Object.freeze(Object.defineProperty({__proto__:null,build:he},Symbol.toStringTag,{value:"Module"}))},889:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r,a=n(32),i=n(230);function o(e){e.code.add(Object(i.b)(r||(r=Object(a.a)(["const float MAX_RGBA_FLOAT =\n255.0 / 256.0 +\n255.0 / 256.0 / 256.0 +\n255.0 / 256.0 / 256.0 / 256.0 +\n255.0 / 256.0 / 256.0 / 256.0 / 256.0;\nconst vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\nvec4 float2rgba(const float value) {\nfloat valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\nvec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\nconst float toU8AsFloat = 1.0 / 255.0;\nreturn fixedPointU8 * toU8AsFloat;\n}\nconst vec4 RGBA_2_FLOAT_FACTORS = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, RGBA_2_FLOAT_FACTORS);\n}"]))))}},890:function(e,t,n){"use strict";n.d(t,"a",(function(){return le})),n.d(t,"b",(function(){return ue}));var r,a,i,o,c,s,u,l,d,f,h,v,b,p,m,g,O,_,x,j,T,y,A,M,S,w=n(32),E=n(741),C=n(742),I=n(442),R=n(636),P=n(637),N=n(743),L=n(501),D=n(634),k=n(761),F=n(496),B=n(744),z=n(762),U=n(750),V=n(638),G=n(749),H=n(763),W=n(658),q=n(495),X=n(764),K=n(641),Y=n(581),Z=n(647),Q=n(765),J=n(584),$=n(443),ee=n(497),te=n(518),ne=n(230),re=n(1055),ae=n(745),ie=n(464),oe=n(344),ce=n(299),se=n(642);function ue(e){var t=new ae.a,n=t.vertex.code,ue=t.fragment.code,le=Object(J.b)(t,e);return t.include(D.a),t.varyings.add("vpos","vec3"),t.include(K.a,e),t.include(N.a,e),t.include(z.a,e),e.output!==I.a.Color&&e.output!==I.a.Alpha||(Object(J.a)(t.vertex,e),t.include(L.a,e),t.include(P.a),e.offsetBackfaces&&t.include(C.a),e.instancedColor&&t.attributes.add(ce.a.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(F.a,e),t.include(E.a,e),t.include(k.a,e),t.include(B.a,e),t.vertex.uniforms.add(new ee.a("externalColor",(function(e){return e.externalColor}))),t.varyings.add("vcolorExt","vec4"),n.add(Object(ne.b)(r||(r=Object(w.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          } else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",ne.b.float(Y.b),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":"",e.hasMultipassTerrain?Object(ne.b)(a||(a=Object(w.a)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),e.output===I.a.Alpha&&(t.include(R.a,e),t.include(Z.a,e),t.include(H.a,e),t.fragment.uniforms.add([new te.a("opacity",(function(e){return e.opacity})),new te.a("layerOpacity",(function(e){return e.layerOpacity})),new re.a("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new ie.a("tex",(function(e){return e.texture}))),t.fragment.include(Q.a),ue.add(Object(ne.b)(i||(i=Object(w.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.hasMultipassTerrain?Object(ne.b)(o||(o=Object(w.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(ne.b)(c||(c=Object(w.a)(["\n                vec4 texColor = texture2D(tex, vuv0);\n                ","\n                discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(ne.b)(s||(s=Object(w.a)(["vec4 texColor = vec4(1.0);"]))),e.hasVertexColors?Object(ne.b)(u||(u=Object(w.a)(["float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(ne.b)(l||(l=Object(w.a)(["float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));"])))))),e.output===I.a.Color&&(t.include(R.a,e),t.include(G.a,e),t.include(V.a,e),t.include(Z.a,e),t.include(e.instancedDoublePrecision?X.b:X.a,e),t.include(H.a,e),Object(J.a)(t.fragment,e),t.fragment.uniforms.add([le,new $.a("ambient",(function(e){return e.ambient})),new $.a("diffuse",(function(e){return e.diffuse})),new te.a("opacity",(function(e){return e.opacity})),new te.a("layerOpacity",(function(e){return e.layerOpacity})),new re.a("view"),new te.a("lightingGlobalFactor",(function(e,t){return t.lighting.globalFactor})),new $.a("lightingMainIntensity",(function(e,t){return t.lighting.mainLight.intensity}))]),t.fragment.constants.add("ambientBoostFactor","float",se.a),e.hasColorTexture&&t.fragment.uniforms.add(new ie.a("tex",(function(e){return e.texture}))),t.include(q.b,e),t.include(W.a,e),t.fragment.include(Q.a),t.extensions.add("GL_OES_standard_derivatives"),ue.add(Object(ne.b)(d||(d=Object(w.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - cameraPosition);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.hasMultipassTerrain?Object(ne.b)(f||(f=Object(w.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(ne.b)(h||(h=Object(w.a)(["\n                vec4 texColor = texture2D(tex, vuv0);\n                ","\n                discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(ne.b)(v||(v=Object(w.a)(["vec4 texColor = vec4(1.0);"]))),e.pbrMode===q.a.Normal?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.hasVertexColors?Object(ne.b)(b||(b=Object(w.a)(["\n                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(ne.b)(p||(p=Object(w.a)(["\n                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))),e.snowCover?Object(ne.b)(m||(m=Object(w.a)(["albedo = mix(albedo, vec3(1), 0.9);"]))):Object(ne.b)(g||(g=Object(w.a)([""]))),Object(ne.b)(O||(O=Object(w.a)(["\n            vec3 shadingNormal = normalize(vNormalWorld);\n            albedo *= 1.2;\n            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);\n            float treeRadialFalloff = vColor.r;\n            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n            additionalLight += backLightFactor * lightingMainIntensity;"]))),e.pbrMode===q.a.Normal||e.pbrMode===q.a.Schematic?e.spherical?Object(ne.b)(_||(_=Object(w.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(ne.b)(x||(x=Object(w.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(ne.b)(j||(j=Object(w.a)([""]))),e.pbrMode===q.a.Normal||e.pbrMode===q.a.Schematic?Object(ne.b)(T||(T=Object(w.a)(["\n                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n                ","\n\n                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"])),e.snowCover?Object(ne.b)(y||(y=Object(w.a)(["\n                        mrr = vec3(0.0, 1.0, 0.04);\n                        emission = vec3(0.0);"]))):""):Object(ne.b)(A||(A=Object(w.a)(["vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);"]))),e.transparencyPassType===oe.h.Color?Object(ne.b)(M||(M=Object(w.a)(["gl_FragColor = premultiplyAlpha(gl_FragColor);"]))):Object(ne.b)(S||(S=Object(w.a)([""])))))),t.include(U.a,e),t}var le=Object.freeze(Object.defineProperty({__proto__:null,build:ue},Symbol.toStringTag,{value:"Module"}))},901:function(e,t,n){"use strict";n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return w})),n.d(t,"c",(function(){return O})),n.d(t,"d",(function(){return E})),n.d(t,"e",(function(){return S}));var r=n(14),a=n(152),i=n(185),o=n(146),c=n(222),s=n(209),u=n(413),l=n(344);n(142),n(143),n(710);function d(e,t,n){var r=n.parameters,a=n.paddingPixelsOverride;return v.scale=Math.min(r.divisor/(t-r.offset),1),v.factor=function(e){return Math.abs(e*e*e)}(e),v.minPixelSize=r.minPixelSize,v.paddingPixels=a,v}function f(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function h(e,t){return Math.max(Object(i.i)(e*t.scale,e,t.factor),f(e,t))}Object(i.f)(10),Object(i.f)(12),Object(i.f)(70),Object(i.f)(40);var v={scale:0,factor:0,minPixelSize:0,paddingPixels:0},b=n(515),p=n(299),m=(n(396),n(349));n(724);new Float64Array(3),new Float32Array(6),Object(m.d)();var g=Object(u.b)();function O(e,t,n,r,a,i,c){if(!function(e){return!!Object(o.k)(e)&&!e.visible}(t))if(e.boundingInfo){Object(b.a)(e.primitiveType===l.e.Triangle);var s=n.tolerance;x(e.boundingInfo,r,a,s,i,c)}else{var u=e.indices.get(p.a.POSITION),d=e.vertexAttributes.get(p.a.POSITION);T(r,a,0,u.length/3,u,d,void 0,i,c)}}var _=Object(s.e)();function x(e,t,n,r,a,i){if(!Object(o.j)(e)){var s=function(e,t,n){return Object(c.u)(n,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}(t,n,_);if(Object(u.l)(g,e.getBBMin()),Object(u.k)(g,e.getBBMax()),Object(o.k)(a)&&a.applyToAabb(g),function(e,t,n,r){return function(e,t,n,r,a){var i=(e[0]-r-t[0])*n[0],o=(e[3]+r-t[0])*n[0],c=Math.min(i,o),s=Math.max(i,o),u=(e[1]-r-t[1])*n[1],l=(e[4]+r-t[1])*n[1];if((s=Math.min(s,Math.max(u,l)))<0)return!1;if((c=Math.max(c,Math.min(u,l)))>s)return!1;var d=(e[2]-r-t[2])*n[2],f=(e[5]+r-t[2])*n[2];return!((s=Math.min(s,Math.max(d,f)))<0)&&!((c=Math.max(c,Math.min(d,f)))>s)&&c<a}(e,t,n,r,1/0)}(g,t,s,r)){var l=e.primitiveIndices,d=e.indices,f=e.position,h=l?l.length:d.length/3;if(h>R){var v=e.getChildren();if(void 0!==v){for(var b=0;b<8;++b)void 0!==v[b]&&x(v[b],t,n,r,a,i);return}}T(t,n,0,h,d,f,l,a,i)}}}var j=Object(s.e)();function T(e,t,n,a,i,c,s,u,l){if(s)return function(e,t,n,a,i,c,s,u,l){for(var d=c.data,f=c.stride||c.size,h=e[0],v=e[1],b=e[2],p=t[0]-h,m=t[1]-v,g=t[2]-b,O=n;O<a;++O){var _,x,T,y,A,S,w=s[O],E=3*w,C=f*i[E++],I=d[C++],R=d[C++],P=d[C];C=f*i[E++];var N=d[C++],L=d[C++],D=d[C];C=f*i[E];var k=d[C++],F=d[C++],B=d[C];Object(o.k)(u)&&(_=u.applyToVertex(I,R,P,O),I=(x=Object(r.a)(_,3))[0],R=x[1],P=x[2],T=u.applyToVertex(N,L,D,O),N=(y=Object(r.a)(T,3))[0],L=y[1],D=y[2],A=u.applyToVertex(k,F,B,O),k=(S=Object(r.a)(A,3))[0],F=S[1],B=S[2]);var z=N-I,U=L-R,V=D-P,G=k-I,H=F-R,W=B-P,q=m*W-H*g,X=g*G-W*p,K=p*H-G*m,Y=z*q+U*X+V*K;if(!(Math.abs(Y)<=Number.EPSILON)){var Z=h-I,Q=v-R,J=b-P,$=Z*q+Q*X+J*K;if(Y>0){if($<0||$>Y)continue}else if($>0||$<Y)continue;var ee=Q*V-U*J,te=J*z-V*Z,ne=Z*U-z*Q,re=p*ee+m*te+g*ne;if(Y>0){if(re<0||$+re>Y)continue}else if(re>0||$+re<Y)continue;var ae=(G*ee+H*te+W*ne)/Y;ae>=0&&l(ae,M(z,U,V,G,H,W,j),w,!1)}}}(e,t,n,a,i,c,s,u,l);for(var d=c.data,f=c.stride||c.size,h=e[0],v=e[1],b=e[2],p=t[0]-h,m=t[1]-v,g=t[2]-b,O=n,_=3*n;O<a;++O){var x,T,y,A,S,w,E=f*i[_++],C=d[E++],I=d[E++],R=d[E];E=f*i[_++];var P=d[E++],N=d[E++],L=d[E];E=f*i[_++];var D=d[E++],k=d[E++],F=d[E];Object(o.k)(u)&&(x=u.applyToVertex(C,I,R,O),C=(T=Object(r.a)(x,3))[0],I=T[1],R=T[2],y=u.applyToVertex(P,N,L,O),P=(A=Object(r.a)(y,3))[0],N=A[1],L=A[2],S=u.applyToVertex(D,k,F,O),D=(w=Object(r.a)(S,3))[0],k=w[1],F=w[2]);var B=P-C,z=N-I,U=L-R,V=D-C,G=k-I,H=F-R,W=m*H-G*g,q=g*V-H*p,X=p*G-V*m,K=B*W+z*q+U*X;if(!(Math.abs(K)<=Number.EPSILON)){var Y=h-C,Z=v-I,Q=b-R,J=Y*W+Z*q+Q*X;if(K>0){if(J<0||J>K)continue}else if(J>0||J<K)continue;var $=Z*U-z*Q,ee=Q*B-U*Y,te=Y*z-B*Z,ne=p*$+m*ee+g*te;if(K>0){if(ne<0||J+ne>K)continue}else if(ne>0||J+ne<K)continue;var re=(V*$+G*ee+H*te)/K;re>=0&&l(re,M(B,z,U,V,G,H,j),O,!1)}}}var y=Object(s.e)(),A=Object(s.e)();function M(e,t,n,r,a,i,o){return Object(c.u)(y,e,t,n),Object(c.u)(A,r,a,i),Object(c.h)(o,y,A),Object(c.p)(o,o),o}function S(e,t,n,r,a){var c=(n.screenLength||0)*e.pixelRatio;Object(o.k)(a)&&(c=function(e,t,n,r){return h(e,d(t,n,r))}(c,r,t,a));var s=c*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(i.d)(s*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)}function w(e,t){var n=t?w(t):{};for(var r in e){var a=e[r];a&&a.forEach&&(a=C(a)),null==a&&r in n||(n[r]=a)}return n}function E(e,t){var n=!1;for(var r in t){var i=t[r];void 0!==i&&(Array.isArray(i)?null===e[r]?(e[r]=i.slice(),n=!0):Object(a.m)(e[r],i)&&(n=!0):e[r]!==i&&(n=!0,e[r]=i))}return n}function C(e){var t=[];return e.forEach((function(e){return t.push(e)})),t}var I={multiply:1,ignore:2,replace:3,tint:4},R=1e3}}]);